<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 80BC</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="load-Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Load routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="802F.html">802F</a>
</td>
<td class="up">Up: <a href="load.html#80bc">Map</a></td>
<td class="next">
Next: <a href="8100.html">8100</a>
</td>
</tr>
</table>
<div class="description">80BC: Prepare to load the standard speed code block</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This section of code is executed immediately after the fast code block has loaded. First of all, it modifies the loading routines at <a href="8000.html">8000</a> and <a href="802F.html">802F</a> to make them suitable for loading a standard speed block.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="80bc"></span>80BC</td>
<td class="instruction">LD B,$0B</td>
<td class="comment-1" rowspan="9">Do the 11 POKEs in the POKE table at <a href="8100.html">8100</a>; these POKEs convert the fast loading routines into standard speed loading routines, ready for the final code block on the tape</td>
</tr>
<tr>
<td class="address-1"><span id="80be"></span>80BE</td>
<td class="instruction">LD D,$80</td>
</tr>
<tr>
<td class="address-1"><span id="80c0"></span>80C0</td>
<td class="instruction">LD HL,$8100</td>
</tr>
<tr>
<td class="address-2"><span id="80c3"></span>80C3</td>
<td class="instruction">LD E,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="80c4"></span>80C4</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="80c5"></span>80C5</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="80c6"></span>80C6</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="80c7"></span>80C7</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="80c8"></span>80C8</td>
<td class="instruction">DJNZ $80C3</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="80ca"></span>
<div class="comments">
<div class="paragraph">
Now a checksum of the bytes at addresses 8100-81AB (just loaded from tape) is calculated.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="80ca"></span>80CA</td>
<td class="instruction">LD L,B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=8100</td>
</tr>
<tr>
<td class="address-1"><span id="80cb"></span>80CB</td>
<td class="instruction">LD E,B</td>
<td class="comment-1" rowspan="2"><span class="register">DE</span>=0000</td>
</tr>
<tr>
<td class="address-1"><span id="80cc"></span>80CC</td>
<td class="instruction">LD D,B</td>
</tr>
<tr>
<td class="address-1"><span id="80cd"></span>80CD</td>
<td class="instruction">LD B,$AC</td>
<td class="comment-1" rowspan="9">Create 'checksums' in <span class="register">A</span> and <span class="register">E</span> of the 172 bytes at addresses 8100-81AB</td>
</tr>
<tr>
<td class="address-2"><span id="80cf"></span>80CF</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="80d0"></span>80D0</td>
<td class="instruction">ADD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="80d1"></span>80D1</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="80d2"></span>80D2</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="80d3"></span>80D3</td>
<td class="instruction">XOR D</td>
</tr>
<tr>
<td class="address-1"><span id="80d4"></span>80D4</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="address-1"><span id="80d5"></span>80D5</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="80d6"></span>80D6</td>
<td class="instruction">DJNZ $80CF</td>
</tr>
<tr>
<td class="address-1"><span id="80d8"></span>80D8</td>
<td class="instruction">LD L,$28</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=8128</td>
</tr>
<tr>
<td class="address-1"><span id="80da"></span>80DA</td>
<td class="instruction">CP $4B</td>
<td class="comment-1" rowspan="1">Is the checksum in <span class="register">A</span> correct?</td>
</tr>
<tr>
<td class="address-1"><span id="80dc"></span>80DC</td>
<td class="instruction">JP NZ,$0000</td>
<td class="comment-1" rowspan="1">Reset the Spectrum if not</td>
</tr>
<tr>
<td class="address-1"><span id="80df"></span>80DF</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="2">Is the checksum in <span class="register">E</span> correct?</td>
</tr>
<tr>
<td class="address-1"><span id="80e0"></span>80E0</td>
<td class="instruction">CP $AF</td>
</tr>
<tr>
<td class="address-1"><span id="80e2"></span>80E2</td>
<td class="instruction">JP Z,<a href="8116.html">$8116</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="80e5"></span>80E5</td>
<td class="instruction">JP $0000</td>
<td class="comment-1" rowspan="1">Otherwise reset the Spectrum</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="802F.html">802F</a>
</td>
<td class="up">Up: <a href="load.html#80bc">Map</a></td>
<td class="next">
Next: <a href="8100.html">8100</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20191116</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../dec/load/32956.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>