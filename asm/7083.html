<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 7083</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7058.html">7058</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7083">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="70A9.html">70A9</a></span></td>
</tr>
</table>
<div class="description">7083: Check whether a character is on a roof with edges on each side</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="ED8C.html">ED8C</a>. Returns to the caller of that routine with <span class="register">A</span> holding 1 (go right), 2 (go left) or 3 (go up) if the character is on the roof of the police station or the apartment building next to no. 19 and is heading for the edge of that roof. Otherwise returns with the zero flag set if the character is standing outside the entrance to a shop or other building.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Identifier for the character's current location (see <a href="ED36.html">ED36</a>)</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xD7-0xE6)</td>
</tr>
<tr>
<td class="register">L</td>
<td class="register-desc">0x0C</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7083"></span>7083</td>
<td class="instruction">CP $FC</td>
<td class="comment-11" rowspan="1">Is the character on the roof of the apartment building next to no. 19?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7085"></span>7085</td>
<td class="instruction">JR Z,$708B</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7087"></span>7087</td>
<td class="instruction">CP $6C</td>
<td class="comment-11" rowspan="1">Is the character on the roof of the police station?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7089"></span>7089</td>
<td class="instruction">JR NZ,$7090</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="708b"></span>708B</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0x6D (police station) or 0xFD (apartment building next to no. 19)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="708c"></span>708C</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character's destination on the edge of the roof of either the police station or the apartment building next to no. 19?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="708d"></span>708D</td>
<td class="instruction">JR Z,$7095</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="708f"></span>708F</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0x6C or 0xFC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7090"></span>7090</td>
<td class="instruction">AND $0F</td>
<td class="comment-11" rowspan="1">Keep only bits 0-3 of the location identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7092"></span>7092</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="1">Set the zero flag if the character is standing outside the entrance to a shop or other building</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7094"></span>7094</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="7095"></span>
<div class="comments">
<div class="paragraph">
The character is on the roof of the apartment building next to no. 19 or on the roof of the police station, and his destination is on the edge of that roof.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7095"></span>7095</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Drop the return address from the stack</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7096"></span>7096</td>
<td class="instruction">LD L,$0A</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0x0A of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7098"></span>7098</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's destination x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7099"></span>7099</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="2">Compare this with the character's current x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="709b"></span>709B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="709c"></span>709C</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0x00 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="709d"></span>709D</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if the character is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="709f"></span>709F</td>
<td class="instruction">LD A,$03</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=3 (go up)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="70a1"></span>70A1</td>
<td class="instruction">JR C,$70A6</td>
<td class="comment-11" rowspan="1">Jump if the character is to the right of his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="70a3"></span>70A3</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return to the caller of <a href="ED8C.html">ED8C</a> with <span class="register">A</span>=3 (go up) if the character is to the left of his destination and facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="70a4"></span>70A4</td>
<td class="instruction">LD A,$01</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1 (go right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="70a6"></span>70A6</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return to the caller of <a href="ED8C.html">ED8C</a> with <span class="register">A</span>=1 (go right) if the character is to the left of his destination and facing left, or with <span class="register">A</span>=3 (go up) if the character is to the right of his destination and facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="70a7"></span>70A7</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Return to the caller of <a href="ED8C.html">ED8C</a> with <span class="register">A</span>=2 (go left) if the character is to the right of his destination and facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="70a8"></span>70A8</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="7058.html">7058</a></span></td>
<td class="up">Up: <a href="../maps/all.html#7083">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="70A9.html">70A9</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20181020</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/contact_sam_cruise/asm/28803.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>