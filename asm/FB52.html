<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at FB52</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="FB4B.html">FB4B</a></span></td>
<td class="up">Up: <a href="../maps/all.html#fb52">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="FC00.html">FC00</a></span></td>
</tr>
</table>
<div class="description">FB52: Deal with a character who is about to step off the roof of a building</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="EBBB.html">EBBB</a>. On entry, <span class="register">B</span> holds the value of the third byte of the character's location descriptor (see <a href="EB13.html">EB13</a>), which indicates the set of locations the character's current location belongs to:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">B</span></th>
<th colspan="1" rowspan="1">Location(s) (x,y,z)</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="3">2</td>
<td class="" colspan="1" rowspan="1">(23,6,1)=right edge of the roof of the apartment building next to no. 74 (see <a href="C3F5.html">C3F5</a>)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">(206,6,1)=right edge of the roof of the apartment building next to no. 19 (see <a href="C3F5.html">C3F5</a>)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">(223,6,1)=left edge of the roof of no. 17 (see <a href="C380.html">C380</a>)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="4">3</td>
<td class="" colspan="1" rowspan="1">(175,6,1)=left edge of the roof of the apartment building next to no. 19 (see <a href="C2D4.html">C2D4</a>)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">(175,11,2)=left edge of the fire escape on the top floor of the apartment building next to no. 19 (see <a href="C2D4.html">C2D4</a>)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">(175,17,2)=left edge of the fire escape on the 3rd floor of the apartment building next to no. 19 (see <a href="C2D4.html">C2D4</a>)</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1">(175,23,2)=left edge of the fire escape on the 2nd floor of the apartment building next to no. 19 (see <a href="C2D4.html">C2D4</a>)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">(124,5,1)=left edge of the roof of the police station (see <a href="BD7B.html">BD7B</a>)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">(118,11,1)=right edge of the roof of no. 31 (see <a href="BD75.html">BD75</a>)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">(177,28,2)=left edge of the fire escape on the 1st floor of the apartment building next to no. 19 (see <a href="C2E2.html#c2ea">C2EA</a>)</td>
</tr>
</table>
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Location indicator (2-6)</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xD7-0xE6)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb52"></span>FB52</td>
<td class="instruction">CALL <a href="FC00.html">$FC00</a></td>
<td class="comment-11" rowspan="1">Deal with the case where <span class="register">B</span>=2 and the character is standing on the edge of the roof of no. 17 or the apartment building next to no. 19</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fb55"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="7AF4.html">7AF4</a> with <span class="register">H</span>=0xE6 (Sam) and <span class="register">B</span>=1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb55"></span>FB55</td>
<td class="instruction">LD L,$0D</td>
<td class="comment-11" rowspan="2">Initialise byte 0x0D of the character's buffer to 0 on the assumption that he will land safely</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb57"></span>FB57</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb59"></span>FB59</td>
<td class="instruction">BIT 0,B</td>
<td class="comment-11" rowspan="1">Does <span class="register">B</span>=2, 4 or 6 (in which case the character will definitely land safely)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb5b"></span>FB5B</td>
<td class="instruction">JR Z,$FB62</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb5d"></span>FB5D</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb5e"></span>FB5E</td>
<td class="instruction">CP $E6</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb60"></span>FB60</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not (characters other than Sam don't attempt dangerous leaps from the roofs of tall buildings)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb61"></span>FB61</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Set byte 0x0D of Sam's buffer to 1 to indicate that he's stepping off or being dropped off the roof of a building from a great enough height that he could be knocked out when he lands (<span class="register">B</span>=1, 3 or 5)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb62"></span>FB62</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam being dropped off the roof of a building?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb63"></span>FB63</td>
<td class="instruction">JR Z,$FB70</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb65"></span>FB65</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="4">Point <span class="register">DE</span> at the appropriate landing y-coordinate in the data table at <a href="FB46.html">FB46</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb66"></span>FB66</td>
<td class="instruction">ADD A,$45</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb68"></span>FB68</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb69"></span>FB69</td>
<td class="instruction">LD D,$FB</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb6b"></span>FB6B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Collect the landing y-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb6c"></span>FB6C</td>
<td class="instruction">LD B,$07</td>
<td class="comment-11" rowspan="1">Prepare to initialise byte 0x14 of the character's buffer to 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb6e"></span>FB6E</td>
<td class="instruction">JR $FB79</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fb70"></span>
<div class="comments">
<div class="paragraph">
We are dealing with Sam being dropped off the roof of a building.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb70"></span>FB70</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb72"></span>FB72</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb73"></span>FB73</td>
<td class="instruction">CALL <a href="EAF8.html#eb05">$EB05</a></td>
<td class="comment-11" rowspan="1">Set the carry flag if there is no sidewalk beneath Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb76"></span>FB76</td>
<td class="instruction">LD A,$22</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=34 if Sam is above the sidewalk, 35 if he's above the road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb78"></span>FB78</td>
<td class="instruction">ADC A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fb79"></span>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span> holds the character's landing y-coordinate, and <span class="register">B</span> holds 0 (if the character is Sam and he's been dropped from the roof of a building) or 7 (if the character is voluntarily stepping off the roof).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb79"></span>FB79</td>
<td class="instruction">LD L,$14</td>
<td class="comment-11" rowspan="2">Set byte 0x14 of the character's buffer to 0 or 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb7b"></span>FB7B</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb7c"></span>FB7C</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Store the character's landing y-coordinate in byte 0x15 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb7d"></span>FB7D</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb7e"></span>FB7E</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb7f"></span>FB7F</td>
<td class="instruction">CP $E6</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb81"></span>FB81</td>
<td class="instruction">JR Z,$FB8E</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb83"></span>FB83</td>
<td class="instruction">LD L,$0F</td>
<td class="comment-11" rowspan="2">Remove the address of any interruptible subcommand routine from bytes 0x0E and 0x0F of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb85"></span>FB85</td>
<td class="instruction">LD (HL),$00</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb87"></span>FB87</td>
<td class="instruction">LD BC,$FB4B</td>
<td class="comment-11" rowspan="3">Set the character's uninterruptible subcommand routine to <a href="FB4B.html">FB4B</a> and jump to it now</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb8a"></span>FB8A</td>
<td class="instruction">PUSH BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb8b"></span>FB8B</td>
<td class="instruction">JP <a href="F9ED.html">$F9ED</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fb8e"></span>
<div class="comments">
<div class="paragraph">
The remainder of this routine deals with Sam's descent from the roof of the building (either to the ground or to the roof of the neighbouring building).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb8e"></span>FB8E</td>
<td class="instruction">LD A,$80</td>
<td class="comment-11" rowspan="2">Set bit 7 of Sam's status flags at <a href="7FFC.html">7FFC</a>, indicating that he's falling from the roof of a building</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb90"></span>FB90</td>
<td class="instruction">LD ($7FFC),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fb93"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="74D8.html">74D8</a> when bit 7 at <a href="7FFC.html">7FFC</a> is set (by this routine - see above).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb93"></span>FB93</td>
<td class="instruction">CALL <a href="EC69.html">$EC69</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb96"></span>FB96</td>
<td class="instruction">LD L,$14</td>
<td class="comment-11" rowspan="2">Collect byte 0x14 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb98"></span>FB98</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb99"></span>FB99</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is Sam falling straight downwards now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb9a"></span>FB9A</td>
<td class="instruction">JR NZ,$FB9D</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb9c"></span>FB9C</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fb9d"></span>FB9D</td>
<td class="instruction">LD L,$08</td>
<td class="comment-11" rowspan="2">Set Sam's main action timer (in byte 0x08 of his buffer) to 1 if he's falling straight downwards now, or to the value of byte 0x14 of his buffer (1-7) if he's still moving left or right at the beginning of his descent</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fb9f"></span>FB9F</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fba0"></span>FBA0</td>
<td class="instruction">CALL <a href="FAE3.html">$FAE3</a></td>
<td class="comment-11" rowspan="1">Move Sam to the next point in his descent</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fba3"></span>FBA3</td>
<td class="instruction">JP C,<a href="EC7B.html#ec83">$EC83</a></td>
<td class="comment-11" rowspan="1">Scroll the screen if necessary if Sam is still falling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fba6"></span>FBA6</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-11" rowspan="2">Set Sam's post-midstride y-coordinate (in byte 0x07 of his buffer) to 0 to indicate that he is neither midstride nor mid-action, and his main action timer (in byte 0x08) to 0 to indicate to the routine at <a href="74D8.html">74D8</a> that Sam has finished falling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fba9"></span>FBA9</td>
<td class="instruction">LD ($E607),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbac"></span>FBAC</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if Sam landed safely (without being knocked out)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fbad"></span>
<div class="comments">
<div class="paragraph">
Sam has landed, and been knocked out by the fall.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbad"></span>FBAD</td>
<td class="instruction">CALL <a href="EA80.html">$EA80</a></td>
<td class="comment-11" rowspan="1">Update the display</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbb0"></span>FBB0</td>
<td class="instruction">CALL <a href="FC6A.html">$FC6A</a></td>
<td class="comment-11" rowspan="1">Scroll the screen up and down a row 7 times (with accompanying sound effects)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbb3"></span>FBB3</td>
<td class="instruction">LD H,$E6</td>
<td class="comment-11" rowspan="1">0xE6=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbb5"></span>FBB5</td>
<td class="instruction">CALL <a href="EB85.html#eb8c">$EB8C</a></td>
<td class="comment-11" rowspan="1">Make Sam stand up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbb8"></span>FBB8</td>
<td class="instruction">CALL <a href="FC57.html">$FC57</a></td>
<td class="comment-11" rowspan="1">Hide the play area and clear the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbbb"></span>FBBB</td>
<td class="instruction">CALL <a href="F17F.html">$F17F</a></td>
<td class="comment-11" rowspan="3">Get a random number between 0x32 and 0x39 (ASCII codes for the digits 2-9) in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbbe"></span>FBBE</td>
<td class="instruction">AND $07</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbc0"></span>FBC0</td>
<td class="instruction">ADD A,$32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbc2"></span>FBC2</td>
<td class="instruction">LD ($7FD0),A</td>
<td class="comment-11" rowspan="1">Store this at <a href="7FD0.html">7FD0</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbc5"></span>FBC5</td>
<td class="instruction">SUB $30</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=N/10 (where N is the number of bucks Sam lost)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbc7"></span>FBC7</td>
<td class="instruction">CALL <a href="6E87.html">$6E87</a></td>
<td class="comment-11" rowspan="1">Adjust Sam's cash supply and print the new amount</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbca"></span>FBCA</td>
<td class="instruction">LD A,$23</td>
<td class="comment-11" rowspan="1">Message <a href="69A1.html">0x23</a>: ' WHEN I CAME TO MY WALLET WAS GONE...'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbcc"></span>FBCC</td>
<td class="instruction">JP Z,<a href="7AB6.html#7ad5">$7AD5</a></td>
<td class="comment-11" rowspan="1">Queue this message and show the ending cutscene if Sam has run out of money</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbcf"></span>FBCF</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a href="69B1.html">0x24</a>: ' WHEN I CAME TO SOMEONE HAD TAKEN ${tens digit}0'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbd0"></span>FBD0</td>
<td class="instruction">CALL <a href="6EC5.html">$6EC5</a></td>
<td class="comment-11" rowspan="1">Queue this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbd3"></span>FBD3</td>
<td class="instruction">CALL <a href="7CD8.html">$7CD8</a></td>
<td class="comment-11" rowspan="1">Take the hook and budgie from Sam (if he has them)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="fbd6"></span>
<div class="comments">
<div class="paragraph">
Now we reveal the play area one row of tiles at a time from the bottom up, with accompanying sound effects.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbd6"></span>FBD6</td>
<td class="instruction">LD HL,$7F60</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at one byte past the end of the <a href="7F00.html">screen refresh buffer</a> (SRB), which is currently clear</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbd9"></span>FBD9</td>
<td class="instruction">LD C,$14</td>
<td class="comment-11" rowspan="1">There are 20 rows of the screen to reveal</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fbdb"></span>FBDB</td>
<td class="instruction">LD B,$04</td>
<td class="comment-11" rowspan="4">Set every bit in a group of 4 bytes of the SRB, corresponding to one row of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fbdd"></span>FBDD</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbde"></span>FBDE</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe0"></span>FBE0</td>
<td class="instruction">DJNZ $FBDD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe2"></span>FBE2</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the screen row counter (in <span class="register">C</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe3"></span>FBE3</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the SRB pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe4"></span>FBE4</td>
<td class="instruction">LD A,$64</td>
<td class="comment-11" rowspan="3"><span class="register">E</span>=0x64-<span class="register">L</span> (where <span class="register">L</span> is the LSB of the SRB address); this value determines the pitch of the sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe6"></span>FBE6</td>
<td class="instruction">SUB L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe7"></span>FBE7</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe8"></span>FBE8</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="5">Multiply <span class="register">C</span> (the screen row counter) by 8; this value determines the duration of the sound effect, and the border colour (0=black)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbe9"></span>FBE9</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbea"></span>FBEA</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbeb"></span>FBEB</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbec"></span>FBEC</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fbed"></span>FBED</td>
<td class="instruction">XOR $10</td>
<td class="comment-11" rowspan="6">Make a sound effect with pitch and duration determined by the row of the screen that is being revealed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbef"></span>FBEF</td>
<td class="instruction">OUT ($FE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbf1"></span>FBF1</td>
<td class="instruction">LD B,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="fbf2"></span>FBF2</td>
<td class="instruction">DJNZ $FBF2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbf4"></span>FBF4</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbf5"></span>FBF5</td>
<td class="instruction">JR NZ,$FBED</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbf7"></span>FBF7</td>
<td class="instruction">CALL <a href="EA80.html">$EA80</a></td>
<td class="comment-11" rowspan="1">Reveal a row of the play area</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbfa"></span>FBFA</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the SRB pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbfb"></span>FBFB</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the screen row counter to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbfc"></span>FBFC</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Have we revealed all 20 rows yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbfd"></span>FBFD</td>
<td class="instruction">JR NZ,$FBDB</td>
<td class="comment-11" rowspan="1">Jump back to reveal the next row if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="fbff"></span>FBFF</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="FB4B.html">FB4B</a></span></td>
<td class="up">Up: <a href="../maps/all.html#fb52">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="FC00.html">FC00</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20181020</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/contact_sam_cruise/asm/64338.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>