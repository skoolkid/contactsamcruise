<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 6412</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="6400.html">6400</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6412">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="647B.html">647B</a></span></td>
</tr>
</table>
<div class="description">6412: Prepare sprite tiles used by Sam when somersaulting or rolling</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="64BD.html">64BD</a>. Animatory states <a href="../graphics/as.html#9">0x09</a>, <a href="../graphics/as.html#10">0x0A</a>, <a href="../graphics/as.html#15">0x0F</a> and <a href="../graphics/as.html#31">0x1F</a> - corresponding to the sprites of Sam rolling and somersaulting - use sprite tiles 0xEF-0xF7. These sprite tiles are initialised before Sam starts his acrobatic manoeuvre, and later rotated as he moves through each phase of animation.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6412"></span>6412</td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="4">Copy sprite tiles 0x02-0x07 over sprite tiles 0xEF-0xF4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6414"></span>6414</td>
<td class="instruction">LD E,$EF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6416"></span>6416</td>
<td class="instruction">LD C,$06</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6418"></span>6418</td>
<td class="instruction">CALL <a href="6400.html">$6400</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="641b"></span>641B</td>
<td class="instruction">LD E,$F2</td>
<td class="comment-11" rowspan="4">Copy sprite tile 0xAA over sprite tile 0xF2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="641d"></span>641D</td>
<td class="instruction">LD L,$AA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="641f"></span>641F</td>
<td class="instruction">INC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6420"></span>6420</td>
<td class="instruction">CALL <a href="6400.html">$6400</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6423"></span>6423</td>
<td class="instruction">LD A,$B5</td>
<td class="comment-11" rowspan="10">Copy sprite tiles 0xB5, 0xBD and 0xC5 from base page 0xD7 over sprite tiles 0xF5-0xF7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6425"></span>6425</td>
<td class="instruction">LD E,$F5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6427"></span>6427</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6428"></span>6428</td>
<td class="instruction">LD H,$D7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="642a"></span>642A</td>
<td class="instruction">INC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="642b"></span>642B</td>
<td class="instruction">CALL <a href="6400.html#6402">$6402</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="642e"></span>642E</td>
<td class="instruction">LD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="642f"></span>642F</td>
<td class="instruction">ADD A,$07</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6431"></span>6431</td>
<td class="instruction">CP $CD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6433"></span>6433</td>
<td class="instruction">JR NZ,$6427</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6435"></span>6435</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="13">Superimpose sprite tile 0xCD from base page 0xD7 over sprite tile 0xF3 (which is currently a copy of sprite tile 0x06, the centre tile of Sam's base animatory state); this makes Sam appear to bend his arms and hold his knees while performing the acrobatic feat, at the expense of losing some detail from his current disguise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6437"></span>6437</td>
<td class="instruction">LD HL,$D7CD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="643a"></span>643A</td>
<td class="instruction">LD DE,$C7F3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="643d"></span>643D</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="643e"></span>643E</td>
<td class="instruction">OR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="643f"></span>643F</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6440"></span>6440</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6441"></span>6441</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6442"></span>6442</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6443"></span>6443</td>
<td class="instruction">INC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6444"></span>6444</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6445"></span>6445</td>
<td class="instruction">INC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6446"></span>6446</td>
<td class="instruction">DJNZ $643D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="6448"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="64BD.html">64BD</a>. Here we rotate sprite tiles 0xEF-0xF7 and store the results in sprite tile slots 0xEE-0xF6.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6448"></span>6448</td>
<td class="instruction">LD L,$EF</td>
<td class="comment-11" rowspan="1">Tile 0xEF is the first source tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="644a"></span>644A</td>
<td class="instruction">LD E,L</td>
<td class="comment-11" rowspan="2"><span class="register">E</span>=0xEE (the first target tile)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="644b"></span>644B</td>
<td class="instruction">DEC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="644c"></span>644C</td>
<td class="instruction">LD D,$C7</td>
<td class="comment-11" rowspan="1">The base page for these tiles is 0xC7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="644e"></span>644E</td>
<td class="instruction">LD B,$08</td>
<td class="comment-11" rowspan="16">Rotate the source sprite tile 90 degrees anticlockwise and copy it over the target sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6450"></span>6450</td>
<td class="instruction">LD H,$C6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6452"></span>6452</td>
<td class="instruction">LD C,$01</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="6454"></span>6454</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6455"></span>6455</td>
<td class="instruction">RRC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6457"></span>6457</td>
<td class="instruction">RLA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6458"></span>6458</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6459"></span>6459</td>
<td class="instruction">RRC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="645b"></span>645B</td>
<td class="instruction">RL C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="645d"></span>645D</td>
<td class="instruction">JR NC,$6454</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="645f"></span>645F</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6460"></span>6460</td>
<td class="instruction">INC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6461"></span>6461</td>
<td class="instruction">LD A,C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6462"></span>6462</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6463"></span>6463</td>
<td class="instruction">INC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6464"></span>6464</td>
<td class="instruction">DJNZ $6450</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6466"></span>6466</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Move to the next source sprite tile reference</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6467"></span>6467</td>
<td class="instruction">BIT 3,L</td>
<td class="comment-11" rowspan="1">Have we rotated sprite tiles 0xEF-0xF7 yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6469"></span>6469</td>
<td class="instruction">JR Z,$644A</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="646b"></span>
<div class="comments">
<div class="paragraph">
Next we move sprite tiles 0xEE-0xF6 up to 0xEF-0xF7.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="646b"></span>646B</td>
<td class="instruction">LD A,$10</td>
<td class="comment-11" rowspan="1">There are 16 bytes of graphic and mask data in each tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="646d"></span>646D</td>
<td class="instruction">LD E,$F7</td>
<td class="comment-11" rowspan="8">Copy sprite tiles 0xEE-0xF6 into slots 0xEF-0xF7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="646f"></span>646F</td>
<td class="instruction">LD L,$F6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6471"></span>6471</td>
<td class="instruction">LD C,$09</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6473"></span>6473</td>
<td class="instruction">DEC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6474"></span>6474</td>
<td class="instruction">LD H,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6475"></span>6475</td>
<td class="instruction">LDDR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6477"></span>6477</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="6478"></span>6478</td>
<td class="instruction">JR NZ,$646D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="647a"></span>647A</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return with the zero flag set</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="6400.html">6400</a></span></td>
<td class="up">Up: <a href="../maps/all.html#6412">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="647B.html">647B</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20181020</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/contact_sam_cruise/asm/25618.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>