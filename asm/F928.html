<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at F928</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F91E.html">F91E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f928">Map</a></td>
<td class="next">
Next: <a href="F95D.html">F95D</a>
</td>
</tr>
</table>
<div class="description">F928: Prepare the sprite tiles used by a character when lying down</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F9D2.html">F9D2</a>. Builds rotated copies of the sprite tiles in the bottom four rows of the leftmost and middle columns of the character's base animatory state and places them in the slots for sprite tiles 0xF8-0xFF (which are used by the animatory state of the character lying down).
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Character's base animatory state</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="f928"></span>F928</td>
<td class="instruction">OR $82</td>
<td class="comment-1" rowspan="3">Point <span class="register">HL</span> at the reference for tile 0 of the character's base animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="f92a"></span>F92A</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="f92b"></span>F92B</td>
<td class="instruction">LD H,$D7</td>
</tr>
<tr>
<td class="address-1"><span id="f92d"></span>F92D</td>
<td class="instruction">LD E,$F7</td>
<td class="comment-1" rowspan="1">The animatory states of the characters lying down use sprite tiles 0xF8-0xFF; initialise the tile reference counter now</td>
</tr>
<tr>
<td class="address-2"><span id="f92f"></span>F92F</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next source sprite tile reference</td>
</tr>
<tr>
<td class="address-1"><span id="f930"></span>F930</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Increment the tile reference counter</td>
</tr>
<tr>
<td class="address-1"><span id="f931"></span>F931</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if we've rotated all 8 sprite tiles</td>
</tr>
<tr>
<td class="address-1"><span id="f932"></span>F932</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=target sprite tile reference (0xF8-0xFF)</td>
</tr>
<tr>
<td class="address-1"><span id="f933"></span>F933</td>
<td class="instruction">CP $FC</td>
<td class="comment-1" rowspan="1">Have we just finished rotating the tiles in the leftmost column of the source sprite?</td>
</tr>
<tr>
<td class="address-1"><span id="f935"></span>F935</td>
<td class="instruction">JR NZ,$F938</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="f937"></span>F937</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=0xDD (where the reference for sprite tile 6 is located)</td>
</tr>
<tr>
<td class="address-2"><span id="f938"></span>F938</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the source sprite tile reference pointer</td>
</tr>
<tr>
<td class="address-1"><span id="f939"></span>F939</td>
<td class="instruction">LD D,$C7</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at where we will place the graphic data for the rotated sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f93b"></span>F93B</td>
<td class="instruction">LD L,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=source sprite tile reference</td>
</tr>
<tr>
<td class="address-1"><span id="f93c"></span>F93C</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">There are 8 pairs of graphic and mask bytes to rotate</td>
</tr>
<tr>
<td class="address-2"><span id="f93e"></span>F93E</td>
<td class="instruction">LD H,$C5</td>
<td class="comment-1" rowspan="1">Initialise the source sprite tile pointer for rotating graphic data</td>
</tr>
<tr>
<td class="address-1"><span id="f940"></span>F940</td>
<td class="instruction">LD A,$80</td>
<td class="comment-1" rowspan="1">Set bit 7 of <span class="register">A</span></td>
</tr>
<tr>
<td class="address-2"><span id="f942"></span>F942</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="5">Collect a pixel column from the source sprite tile's graphic data</td>
</tr>
<tr>
<td class="address-1"><span id="f943"></span>F943</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f944"></span>F944</td>
<td class="instruction">RLC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="f946"></span>F946</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="address-1"><span id="f947"></span>F947</td>
<td class="instruction">JR NC,$F942</td>
</tr>
<tr>
<td class="address-1"><span id="f949"></span>F949</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Insert the pixel column of graphic data as a pixel row into the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f94a"></span>F94A</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the corresponding pixel row of mask data in the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f94b"></span>F94B</td>
<td class="instruction">LD H,$C6</td>
<td class="comment-1" rowspan="1">Initialise the source sprite tile pointer for rotating mask data</td>
</tr>
<tr>
<td class="address-1"><span id="f94d"></span>F94D</td>
<td class="instruction">LD A,$80</td>
<td class="comment-1" rowspan="1">Set bit 7 of <span class="register">A</span></td>
</tr>
<tr>
<td class="address-2"><span id="f94f"></span>F94F</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="5">Collect a pixel column from the source sprite tile's mask data</td>
</tr>
<tr>
<td class="address-1"><span id="f950"></span>F950</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f951"></span>F951</td>
<td class="instruction">RLC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="f953"></span>F953</td>
<td class="instruction">RRA</td>
</tr>
<tr>
<td class="address-1"><span id="f954"></span>F954</td>
<td class="instruction">JR NC,$F94F</td>
</tr>
<tr>
<td class="address-1"><span id="f956"></span>F956</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Insert the pixel column of mask data as a pixel row into the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f957"></span>F957</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next pixel row of graphic data in the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f958"></span>F958</td>
<td class="instruction">DJNZ $F93E</td>
<td class="comment-1" rowspan="1">Jump back until we've done all 8 pairs of graphic and mask bytes</td>
</tr>
<tr>
<td class="address-1"><span id="f95a"></span>F95A</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the source sprite tile reference pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="f95b"></span>F95B</td>
<td class="instruction">JR $F92F</td>
<td class="comment-1" rowspan="1">Jump back to build the next rotated sprite tile</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F91E.html">F91E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f928">Map</a></td>
<td class="next">
Next: <a href="F95D.html">F95D</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20221122</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/63784.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>