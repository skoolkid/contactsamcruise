<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at F95E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F95D.html">F95D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f95e">Map</a></td>
<td class="next">
Next: <a href="F9D1.html">F9D1</a>
</td>
</tr>
</table>
<div class="description">F95E: Change Sam's disguise</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Continues from the routine at <a href="FADA.html">FADA</a>. Replaces certain sprite tiles that are used by Sam's animatory states (thus changing his appearance), and then draws Sam's new disguise in the bottom right corner of the screen.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">0xE6 (Sam)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="f95e"></span>F95E</td>
<td class="instruction">LD L,$08</td>
<td class="comment-1" rowspan="2">Set Sam's main action timer (in byte 0x08 of his buffer) to 8</td>
</tr>
<tr>
<td class="address-1"><span id="f960"></span>F960</td>
<td class="instruction">LD (HL),L</td>
</tr>
<tr>
<td class="address-1"><span id="f961"></span>F961</td>
<td class="instruction">LD HL,$7FC9</td>
<td class="comment-1" rowspan="1"><a href="7FC9.html">7FC9</a> holds Sam's current disguise ID</td>
</tr>
<tr>
<td class="address-1"><span id="f964"></span>F964</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="f965"></span>F965</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=next disguise ID (0-7)</td>
</tr>
<tr>
<td class="address-1"><span id="f966"></span>F966</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="f968"></span>F968</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store the new disguise ID</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f969"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="790D.html">790D</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="f969"></span>F969</td>
<td class="instruction">CALL <a href="7D09.html#7d0a">$7D0A</a></td>
<td class="comment-1" rowspan="1">Set the attribute bytes for Sam's current disguise</td>
</tr>
<tr>
<td class="address-1"><span id="f96c"></span>F96C</td>
<td class="instruction">LD A,($7FC9)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Sam's disguise ID (0-7)</td>
</tr>
<tr>
<td class="address-1"><span id="f96f"></span>F96F</td>
<td class="instruction">ADD A,$DF</td>
<td class="comment-1" rowspan="3">Point <span class="register">BC</span> at the reference for the first replacement tile (in the data table at <a href="DF3E.html">DF3E</a>, <a href="E03E.html">E03E</a>, <a href="E13E.html">E13E</a>, <a href="E23E.html">E23E</a>, <a href="E33E.html">E33E</a>, <a href="E43E.html">E43E</a>, <a href="E53E.html">E53E</a> or <a href="E63E.html">E63E</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="f971"></span>F971</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="f972"></span>F972</td>
<td class="instruction">LD C,$3E</td>
</tr>
<tr>
<td class="address-1"><span id="f974"></span>F974</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="f975"></span>F975</td>
<td class="instruction">LD HL,$DE3D</td>
<td class="comment-1" rowspan="1"><span class="register">HL'</span> will index the sprite tile reference data table at <a href="DE3E.html">DE3E</a></td>
</tr>
<tr>
<td class="address-1"><span id="f978"></span>F978</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="f979"></span>F979</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="f97a"></span>F97A</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at the next sprite tile reference</td>
</tr>
<tr>
<td class="address-1"><span id="f97b"></span>F97B</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Collect the tile reference in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="f97c"></span>F97C</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="f97d"></span>F97D</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Have we reached the end of the table?</td>
</tr>
<tr>
<td class="address-1"><span id="f97e"></span>F97E</td>
<td class="instruction">JR Z,$F9AA</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="f980"></span>F980</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">DE</span> at the first byte of graphic data for this sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f981"></span>F981</td>
<td class="instruction">LD D,$C7</td>
</tr>
<tr>
<td class="address-1"><span id="f983"></span>F983</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=reference for the replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f984"></span>F984</td>
<td class="instruction">INC C</td>
<td class="comment-1" rowspan="1">Point <span class="register">BC</span> at the reference for the next replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f985"></span>F985</td>
<td class="instruction">CP $7E</td>
<td class="comment-1" rowspan="1">Set the carry flag if the tile reference is &lt; 0x7E</td>
</tr>
<tr>
<td class="address-1"><span id="f987"></span>F987</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=reference for the replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f988"></span>F988</td>
<td class="instruction">JR NC,$F99C</td>
<td class="comment-1" rowspan="1">Jump if we're dealing with a tile reference &gt;= 0x7E</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f98a"></span>
<div class="comments">
<div class="paragraph">
We're dealing with a replacement tile (of Sam in disguise) whose reference is &lt; 0x7E. The graphic data for such tiles is arranged in 8 pairs (graphic byte, mask byte) in bytes 0x50-0x7D across pages 0xDF-0xE6.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="f98a"></span>F98A</td>
<td class="instruction">LD H,$DF</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the graphic data for the replacement tile</td>
</tr>
<tr>
<td class="address-2"><span id="f98c"></span>F98C</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Copy a byte of graphic data from the replacement tile into the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f98d"></span>F98D</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="f98e"></span>F98E</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next byte of mask data for the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f98f"></span>F98F</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next byte of mask data for the replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f990"></span>F990</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Copy a byte of mask data from the replacement tile into the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f991"></span>F991</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="f992"></span>F992</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next byte of graphic data for the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f993"></span>F993</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the next byte of graphic data for the replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f994"></span>F994</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f995"></span>F995</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="2">Have we copied the replacement tile over the target sprite tile yet?</td>
</tr>
<tr>
<td class="address-1"><span id="f996"></span>F996</td>
<td class="instruction">CP $E7</td>
</tr>
<tr>
<td class="address-1"><span id="f998"></span>F998</td>
<td class="instruction">JR NZ,$F98C</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="address-1"><span id="f99a"></span>F99A</td>
<td class="instruction">JR $F979</td>
<td class="comment-1" rowspan="1">Jump back to deal with the next replacement tile</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f99c"></span>
<div class="comments">
<div class="paragraph">
We're dealing with a replacement tile whose reference is &gt;= 0x7E. The graphic data for such tiles is arranged in groups of 16 (8 pairs of graphic bytes and mask bytes) across pages 0xD7-0xE6.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="f99c"></span>F99C</td>
<td class="instruction">LD H,$D7</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the graphic data for the replacement tile</td>
</tr>
<tr>
<td class="address-1"><span id="f99e"></span>F99E</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Save the replacement tile reference pointer</td>
</tr>
<tr>
<td class="address-1"><span id="f99f"></span>F99F</td>
<td class="instruction">LD B,$10</td>
<td class="comment-1" rowspan="1">There are 16 bytes of graphic and mask data to copy</td>
</tr>
<tr>
<td class="address-2"><span id="f9a1"></span>F9A1</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="5">Copy the replacement tile over the target sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="f9a2"></span>F9A2</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="f9a3"></span>F9A3</td>
<td class="instruction">INC D</td>
</tr>
<tr>
<td class="address-1"><span id="f9a4"></span>F9A4</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f9a5"></span>F9A5</td>
<td class="instruction">DJNZ $F9A1</td>
</tr>
<tr>
<td class="address-1"><span id="f9a7"></span>F9A7</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the replacement tile reference pointer to <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="f9a8"></span>F9A8</td>
<td class="instruction">JR $F979</td>
<td class="comment-1" rowspan="1">Jump back to deal with the next replacement tile</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f9aa"></span>
<div class="comments">
<div class="paragraph">
Now we can draw Sam's disguise in the bottom right of the screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="f9aa"></span>F9AA</td>
<td class="instruction">LD HL,$D782</td>
<td class="comment-1" rowspan="1">This is the address of the tile reference for the top-left tile in Sam's sprite (animatory state <a href="../graphics/as.html#0">0x00</a>)</td>
</tr>
<tr>
<td class="address-1"><span id="f9ad"></span>F9AD</td>
<td class="instruction">LD DE,$50BD</td>
<td class="comment-1" rowspan="1">50BD is the display file address for the leftmost byte in the top row of pixels of Sam's disguise in the bottom right of the screen</td>
</tr>
<tr>
<td class="address-2"><span id="f9b0"></span>F9B0</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the sprite tile reference pointer</td>
</tr>
<tr>
<td class="address-1"><span id="f9b1"></span>F9B1</td>
<td class="instruction">LD L,(HL)</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the first byte of graphic data for this tile</td>
</tr>
<tr>
<td class="address-1"><span id="f9b2"></span>F9B2</td>
<td class="instruction">LD H,$C7</td>
</tr>
<tr>
<td class="address-2"><span id="f9b4"></span>F9B4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="7">Copy the tile to the screen</td>
</tr>
<tr>
<td class="address-1"><span id="f9b5"></span>F9B5</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="address-1"><span id="f9b6"></span>F9B6</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f9b7"></span>F9B7</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f9b8"></span>F9B8</td>
<td class="instruction">INC D</td>
</tr>
<tr>
<td class="address-1"><span id="f9b9"></span>F9B9</td>
<td class="instruction">BIT 3,D</td>
</tr>
<tr>
<td class="address-1"><span id="f9bb"></span>F9BB</td>
<td class="instruction">JR Z,$F9B4</td>
</tr>
<tr>
<td class="address-1"><span id="f9bd"></span>F9BD</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the sprite tile reference pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="f9be"></span>F9BE</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next tile reference</td>
</tr>
<tr>
<td class="address-1"><span id="f9bf"></span>F9BF</td>
<td class="instruction">LD D,$50</td>
<td class="comment-1" rowspan="4">Set <span class="register">DE</span> to the display file address for the next tile</td>
</tr>
<tr>
<td class="address-1"><span id="f9c1"></span>F9C1</td>
<td class="instruction">LD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="f9c2"></span>F9C2</td>
<td class="instruction">ADD A,$20</td>
</tr>
<tr>
<td class="address-1"><span id="f9c4"></span>F9C4</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="f9c5"></span>F9C5</td>
<td class="instruction">JR NC,$F9B0</td>
<td class="comment-1" rowspan="1">Jump back unless we've finished a column of three tiles</td>
</tr>
<tr>
<td class="address-1"><span id="f9c7"></span>F9C7</td>
<td class="instruction">CP $1F</td>
<td class="comment-1" rowspan="1">Have we just finished the third column?</td>
</tr>
<tr>
<td class="address-1"><span id="f9c9"></span>F9C9</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="f9ca"></span>F9CA</td>
<td class="instruction">SUB $5F</td>
<td class="comment-1" rowspan="2">Set <span class="register">DE</span> to the display file address for the first tile in the next column</td>
</tr>
<tr>
<td class="address-1"><span id="f9cc"></span>F9CC</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="f9cd"></span>F9CD</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the reference for the first tile in this column</td>
</tr>
<tr>
<td class="address-1"><span id="f9ce"></span>F9CE</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="f9cf"></span>F9CF</td>
<td class="instruction">JR $F9B0</td>
<td class="comment-1" rowspan="1">Jump back to draw this column of tiles</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F95D.html">F95D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f95e">Map</a></td>
<td class="next">
Next: <a href="F9D1.html">F9D1</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20221122</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/63838.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>