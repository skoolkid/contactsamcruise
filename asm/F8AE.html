<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at F8AE</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F87E.html">F87E</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f8ae">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F905.html">F905</a></span></td>
</tr>
</table>
<div class="description">F8AE: Prepare for demo mode or a new game</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="F0BE.html">F0BE</a>. Prepares everything for demo mode or a new game and then displays the introductory cutscene.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f8ae"></span>F8AE</td>
<td class="instruction">CALL <a href="FC46.html">$FC46</a></td>
<td class="comment-11" rowspan="1">Generate the table of mirrored values of 0x00-0xFF at <a href="7E00.html">7E00</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8b1"></span>
<div class="comments">
<div class="paragraph">
Now we initialise the game status buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8b1"></span>F8B1</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=7F00</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8b2"></span>F8B2</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-11" rowspan="4">Zero out the first 222 bytes of the game status buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8b3"></span>F8B3</td>
<td class="instruction">LD C,$DD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8b5"></span>F8B5</td>
<td class="instruction">LD DE,$7F01</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8b8"></span>F8B8</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8ba"></span>F8BA</td>
<td class="instruction">LD E,$E0</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=7FE0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8bc"></span>F8BC</td>
<td class="instruction">LD HL,$FFE0</td>
<td class="comment-11" rowspan="3">Copy the data at <a href="FFE0.html">FFE0</a> into the last 32 bytes of the game status buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8bf"></span>F8BF</td>
<td class="instruction">LD C,$20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8c1"></span>F8C1</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8c3"></span>
<div class="comments">
<div class="paragraph">
Next we ensure that all the shop and house doors are closed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8c3"></span>F8C3</td>
<td class="instruction">LD B,$20</td>
<td class="comment-11" rowspan="1">There are 32 Z values to check (one for each 8-tile wide segment of the play area)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8c5"></span>F8C5</td>
<td class="instruction">LD HL,$BD00</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first Z value for y-coordinates 30-35 at <a href="BD00.html">BD00</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f8c8"></span>F8C8</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the Z value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8c9"></span>F8C9</td>
<td class="instruction">CP $53</td>
<td class="comment-11" rowspan="4">Jump unless the Z value corresponds to the open door of a shop (0x50) or house (0x51 or 0x52)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8cb"></span>F8CB</td>
<td class="instruction">JR NC,$F8D9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8cd"></span>F8CD</td>
<td class="instruction">CP $50</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8cf"></span>F8CF</td>
<td class="instruction">JR C,$F8D9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8d1"></span>F8D1</td>
<td class="instruction">SET 2,(HL)</td>
<td class="comment-11" rowspan="1">Set bit 2 of the Z value, thus closing the door</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8d3"></span>F8D3</td>
<td class="instruction">JR NZ,$F8D9</td>
<td class="comment-11" rowspan="1">Jump unless we are dealing with a shop door</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8d5"></span>F8D5</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="2">Update the Z value in the block at <a href="BE00.html">BE00</a> if we are dealing with a shop door</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8d6"></span>F8D6</td>
<td class="instruction">LD (HL),$53</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8d8"></span>F8D8</td>
<td class="instruction">DEC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> back at the block of Z values at <a href="BD00.html">BD00</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f8d9"></span>F8D9</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the next Z value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8da"></span>F8DA</td>
<td class="instruction">DJNZ $F8C8</td>
<td class="comment-11" rowspan="1">Jump back until we've checked every Z value</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8dc"></span>
<div class="comments">
<div class="paragraph">
Next we initialise characters 0xD7-0xDD, the icon panel, the score box, the message line, the phone messages, the event table at <a href="5FE0.html">5FE0</a> and the object table at <a href="7D1C.html">7D1C</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8dc"></span>F8DC</td>
<td class="instruction">CALL <a href="F7F0.html">$F7F0</a></td>
<td class="comment-11" rowspan="1">Initialise the character buffers for character groups 0xD7-0xDD</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8df"></span>F8DF</td>
<td class="instruction">CALL <a href="7058.html">$7058</a></td>
<td class="comment-11" rowspan="1">Initialise the icon panel, score box and message line</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8e2"></span>F8E2</td>
<td class="instruction">CALL <a href="7AE2.html">$7AE2</a></td>
<td class="comment-11" rowspan="1">Prepare the phone messages, events and objects</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8e5"></span>
<div class="comments">
<div class="paragraph">
Let's not forget about the rope that may be above the roof of no. 19.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8e5"></span>F8E5</td>
<td class="instruction">LD HL,$0B0B</td>
<td class="comment-11" rowspan="2">Set the appropriate Z values in the block at <a href="B900.html">B900</a> to 11, thus removing the rope (if any) from above the roof of no. 19</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8e8"></span>F8E8</td>
<td class="instruction">LD ($B91A),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8eb"></span>
<div class="comments">
<div class="paragraph">
And finally we initialise the main characters (0xDE-0xE6) before displaying the introductory cutscene.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8eb"></span>F8EB</td>
<td class="instruction">LD A,($7FEE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=current game mode (0 or 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8ee"></span>F8EE</td>
<td class="instruction">JR $F8F5</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="f8f0"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6100.html">6100</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f8f0"></span>F8F0</td>
<td class="instruction">LD HL,$7FEE</td>
<td class="comment-11" rowspan="1"><a href="7FEE.html">7FEE</a> holds the current game mode (0-4)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8f3"></span>F8F3</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Move to the next game mode</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8f4"></span>F8F4</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=next game mode</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="f8f5"></span>F8F5</td>
<td class="instruction">CALL <a href="F87E.html">$F87E</a></td>
<td class="comment-11" rowspan="1">Initialise the character buffers for characters 0xDE-0xE6</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8f8"></span>F8F8</td>
<td class="instruction">DEC H</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the message number in the set of initialisation parameters for the current game mode for Sam (see <a href="E620.html">E620</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8f9"></span>F8F9</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8fa"></span>F8FA</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the message number in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8fb"></span>F8FB</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8fc"></span>F8FC</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Pick up the new y-coordinate for the topmost row of the play area on screen in <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8fd"></span>F8FD</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8fe"></span>F8FE</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Pick up the new x-coordinate for the topmost row of the play area on screen in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f8ff"></span>F8FF</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f900"></span>F900</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Pick up the LSB of the address of the screen refresh buffer byte that corresponds to the top row of the cutscene window</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f901"></span>F901</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="f902"></span>F902</td>
<td class="instruction">JP <a href="7AB6.html#7adb">$7ADB</a></td>
<td class="comment-11" rowspan="1">Display the cutscene</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="F87E.html">F87E</a></span></td>
<td class="up">Up: <a href="../maps/all.html#f8ae">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="F905.html">F905</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20181020</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/contact_sam_cruise/asm/63662.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>