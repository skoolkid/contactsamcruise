<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at F7B1</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F7B0.html">F7B0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f7b1">Map</a></td>
<td class="next">
Next: <a href="F7BF.html">F7BF</a>
</td>
</tr>
</table>
<div class="description">F7B1: Change the primary command routine address</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="634C.html">634C</a>, <a href="7A6A.html">7A6A</a> and <a href="F748.html">F748</a>. Places the address of the instruction following the CALL to this routine into bytes 0x08 and 0x09 of the character's buffer, thus making it the address of the character's primary command routine.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xD7-0xE5)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="f7b1"></span>F7B1</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="3">Collect the return address from the stack into <span class="register">DE</span></td>
</tr>
<tr>
<td class="address-1"><span id="f7b2"></span>F7B2</td>
<td class="instruction">EX (SP),HL</td>
</tr>
<tr>
<td class="address-1"><span id="f7b3"></span>F7B3</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="f7b4"></span>F7B4</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1">Save <span class="register">L</span> in <span class="register">A</span> briefly</td>
</tr>
<tr>
<td class="address-1"><span id="f7b5"></span>F7B5</td>
<td class="instruction">LD L,$08</td>
<td class="comment-1" rowspan="4">Copy the return address into bytes 0x08 and 0x09 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="f7b7"></span>F7B7</td>
<td class="instruction">LD (HL),E</td>
</tr>
<tr>
<td class="address-1"><span id="f7b8"></span>F7B8</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="f7b9"></span>F7B9</td>
<td class="instruction">LD (HL),D</td>
</tr>
<tr>
<td class="address-1"><span id="f7ba"></span>F7BA</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Restore the original contents of <span class="register">L</span></td>
</tr>
<tr>
<td class="address-1"><span id="f7bb"></span>F7BB</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="3">Restore the return address to the stack</td>
</tr>
<tr>
<td class="address-1"><span id="f7bc"></span>F7BC</td>
<td class="instruction">EX (SP),HL</td>
</tr>
<tr>
<td class="address-1"><span id="f7bd"></span>F7BD</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="address-1"><span id="f7be"></span>F7BE</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F7B0.html">F7B0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f7b1">Map</a></td>
<td class="next">
Next: <a href="F7BF.html">F7BF</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20191116</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../dec/asm/63409.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>