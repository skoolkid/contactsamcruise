<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 76FA</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="76F9.html">76F9</a></span></td>
<td class="up">Up: <a href="../maps/all.html#76fa">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="772F.html">772F</a></span></td>
</tr>
</table>
<div class="description">76FA: 'T' pressed - telephone</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this routine is found in the table of keypress handling routines at <a href="ED00.html">ED00</a>. It is called from the main loop at <a href="F02B.html">F02B</a> when 'T' is pressed.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">0xE6 (Sam)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="76fa"></span>76FA</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="749E.html">$749E</a></td>
<td class="comment-11" rowspan="1">Is Sam standing next to a telephone?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="76fd"></span>76FD</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="76fe"></span>76FE</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,$7F92</td>
<td class="comment-11" rowspan="1">The buffer at <a href="7F92.html">7F92</a> will hold the digits dialled by Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7701"></span>7701</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,$0500</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=5, <span class="register">C</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7704"></span>7704</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),C</td>
<td class="comment-11" rowspan="3">Initialise the digit buffer at <a href="7F92.html">7F92</a> by filling it with zeroes</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7705"></span>7705</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7706"></span>7706</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ $7704</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7708"></span>7708</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$9B</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7F9B.html">7F9B</a> (telephone call status flags)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="770a"></span>770A</td>
<td class="bytes-0"></td>
<td class="instruction">CCF</td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=0x80 if the phone is ringing, 0x00 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="770b"></span>770B</td>
<td class="bytes-0"></td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="770c"></span>770C</td>
<td class="bytes-0"></td>
<td class="instruction">AND $80</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="770e"></span>770E</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Set bit 7 at <a href="7F9B.html">7F9B</a> if Sam has picked up a ringing telephone</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="770f"></span>770F</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$FC</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="7FFC.html">7FFC</a> (Sam's status flags)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7711"></span>7711</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),$10</td>
<td class="comment-11" rowspan="1">Set bit 4: Sam is on the phone</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7713"></span>7713</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$D3</td>
<td class="comment-11" rowspan="2">Store the phone's identifier at <a href="7FD3.html">7FD3</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7715"></span>7715</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7716"></span>7716</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,$771F</td>
<td class="comment-11" rowspan="1">Jump if the phone is ringing</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7718"></span>7718</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,$02</td>
<td class="comment-11" rowspan="2">Subtract $2 from Sam's cash supply</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="771a"></span>771A</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="6E87.html#6e8c">$6E8C</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="771d"></span>771D</td>
<td class="bytes-0"></td>
<td class="instruction">JR $7725</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="771f"></span>
<div class="comments">
<div class="paragraph">
Sam has picked up a telephone that is ringing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="771f"></span>771F</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,($5C79)</td>
<td class="comment-11" rowspan="1">Collect the second byte of the FRAMES system variable, which is incremented every 5.12s</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7722"></span>7722</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,$99</td>
<td class="comment-11" rowspan="2">Copy this byte to <a href="7F99.html">7F99</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="7724"></span>7724</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7725"></span>7725</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,$29</td>
<td class="comment-11" rowspan="1">Message <a href="69F9.html">0x29</a>: 'I LIFTED THE PHONE '</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7727"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the unused routine at <a href="7A34.html">7A34</a> with <span class="register">A</span>=<a href="69E9.html">0x27</a>: 'I HUNG UP'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="7727"></span>7727</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="75CA.html">$75CA</a></td>
<td class="comment-11" rowspan="1">Queue the message urgently</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="772a"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="F1E3.html">F1E3</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="772a"></span>772A</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,$E6</td>
<td class="comment-11" rowspan="1">0xE6=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="772c"></span>772C</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="ECE1.html#ecee">$ECEE</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="76F9.html">76F9</a></span></td>
<td class="up">Up: <a href="../maps/all.html#76fa">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="772F.html">772F</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20190619</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../dec/asm/30458.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>