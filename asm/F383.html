<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at F383</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F375.html">F375</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f383">Map</a></td>
<td class="next">
Next: <a href="F39B.html">F39B</a>
</td>
</tr>
</table>
<div class="description">F383: Control a character who is knocking on or opening a door (3)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this interruptible subcommand routine is placed into bytes 0x0E and 0x0F of a character's buffer by the routine at <a href="F375.html">F375</a>. At this point, either the character has opened the door already (in which case this routine does nothing more than verify that the door is still open and then terminate the subcommand), or he is knocking on the door repeatedly (in which case he must be a policeman).
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (0xD7-0xE5)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="f383"></span>F383</td>
<td class="instruction">LD L,$00</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0x00 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="f385"></span>F385</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Does the character have his arm raised?</td>
</tr>
<tr>
<td class="address-1"><span id="f387"></span>F387</td>
<td class="instruction">JR NZ,<a href="F375.html#f37b">$F37B</a></td>
<td class="comment-1" rowspan="1">Make the character lower his arm if so</td>
</tr>
<tr>
<td class="address-1"><span id="f389"></span>F389</td>
<td class="instruction">LD D,H</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="f38a"></span>F38A</td>
<td class="instruction">CALL <a href="F293.html">$F293</a></td>
<td class="comment-1" rowspan="1">Check whether the door is open</td>
</tr>
<tr>
<td class="address-1"><span id="f38d"></span>F38D</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="f38e"></span>F38E</td>
<td class="instruction">JP NZ,<a href="F280.html#f284">$F284</a></td>
<td class="comment-1" rowspan="1">Terminate this subcommand if the door is open</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="f391"></span>
<div class="comments">
<div class="paragraph">
This character must be a policeman. In this case, he will knock repeatedly for a while, and then open the door by force if there's no answer.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="f391"></span>F391</td>
<td class="instruction">LD L,$10</td>
<td class="comment-1" rowspan="2">Decrement the counter in byte 0x10 of the policeman's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="f393"></span>F393</td>
<td class="instruction">DEC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="f394"></span>F394</td>
<td class="instruction">JP NZ,<a href="F338.html#f33c">$F33C</a></td>
<td class="comment-1" rowspan="1">Raise the policeman's arm for another knock if the counter has not reached zero</td>
</tr>
<tr>
<td class="address-1"><span id="f397"></span>F397</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the door status flags</td>
</tr>
<tr>
<td class="address-1"><span id="f398"></span>F398</td>
<td class="instruction">JP <a href="F2A8.html#f2b3">$F2B3</a></td>
<td class="comment-1" rowspan="1">Bust open the door</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="F375.html">F375</a>
</td>
<td class="up">Up: <a href="../maps/all.html#f383">Map</a></td>
<td class="next">
Next: <a href="F39B.html">F39B</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20191116</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../dec/asm/62339.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>