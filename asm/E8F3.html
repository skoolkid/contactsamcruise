<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at E8F3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="E8F0.html">E8F0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#e8f3">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="E9BF.html">E9BF</a></span></td>
</tr>
</table>
<div class="description">E8F3: Superimpose sprite tiles onto a tile of the play area</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="E70C.html">E70C</a>. If any part of a character's sprite needs to be printed at the row and column specified by <span class="register">DE'</span>, the appropriate tile is located and superimposed onto the contents of the buffer at <a href="A01E.html">A01E</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">2</td>
</tr>
<tr>
<td class="register">D'</td>
<td class="register-desc">Play area y-coordinate</td>
</tr>
<tr>
<td class="register">E'</td>
<td class="register-desc">Play area x-coordinate</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e8f3"></span>E8F3</td>
<td class="instruction">CALL $E8F8</td>
<td class="comment-11" rowspan="1">Superimpose sprite tiles for characters whose z-coordinate is 2 (between a building and the sidewalk)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e8f6"></span>E8F6</td>
<td class="instruction">LD A,$04</td>
<td class="comment-11" rowspan="1">Prepare to superimpose sprite tiles for characters whose z-coordinate is 4 (on the sidewalk or road)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e8f8"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="E70C.html">E70C</a> with <span class="register">A</span>=1 (to superimpose sprite tiles for characters who are indoors).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e8f8"></span>E8F8</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e8f9"></span>E8F9</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1"><span class="register">C'</span>=1 (indoors), 2 (between buildings and the sidewalk) or 4 (on the sidewalk or road)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e8fa"></span>E8FA</td>
<td class="instruction">LD H,$D7</td>
<td class="comment-11" rowspan="1">0xD7 is the first character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e8fc"></span>E8FC</td>
<td class="instruction">LD L,$04</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x04 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e8fe"></span>E8FE</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's z-coordinate (1, 2, 4 or 8)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e8ff"></span>E8FF</td>
<td class="instruction">AND C</td>
<td class="comment-11" rowspan="1">Reset the zero flag if the character's sprite should be printed</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e900"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="6592.html">6592</a> with <span class="register">H</span>=0xE6 (Sam), <span class="register">DE</span> holding the play area coordinates of a bullet, and the zero flag reset unless Sam's indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e900"></span>E900</td>
<td class="instruction">JR Z,$E95E</td>
<td class="comment-11" rowspan="1">Consider the next character if this one should not be printed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e902"></span>E902</td>
<td class="instruction">LD L,$00</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x00 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e904"></span>E904</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e905"></span>E905</td>
<td class="instruction">AND $7F</td>
<td class="comment-11" rowspan="1">Drop the direction bit (bit 7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e907"></span>E907</td>
<td class="instruction">CP $78</td>
<td class="comment-11" rowspan="1">Is this character's animatory state &gt;= 0x78?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e909"></span>E909</td>
<td class="instruction">JR NC,$E945</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e90b"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is &lt; 0x78, which means he has a 5x3 sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e90b"></span>E90B</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L'</span>=0x01</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e90c"></span>E90C</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state + 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e90d"></span>E90D</td>
<td class="instruction">AND $07</td>
<td class="comment-11" rowspan="1">Reduce this modulo 8</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e90f"></span>E90F</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=X, the play area x-coordinate (0-255)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e910"></span>E910</td>
<td class="instruction">JR Z,$E92C</td>
<td class="comment-11" rowspan="1">Jump if the character's animatory state is congruent to 7 mod 8</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e912"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is congruent to 0-6 mod 8, which means he has a sprite with 5 rows and 3 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e912"></span>E912</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e913"></span>E913</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Does any part of the sprite impinge on column X?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e915"></span>E915</td>
<td class="instruction">JR NC,$E95E</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e917"></span>E917</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L'</span>=0x00</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e918"></span>E918</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e91a"></span>E91A</td>
<td class="instruction">JR Z,$E91F</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e91c"></span>E91C</td>
<td class="instruction">CPL</td>
<td class="comment-11" rowspan="2">Set <span class="register">A</span> to 2-<span class="register">A</span> if the character is facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e91d"></span>E91D</td>
<td class="instruction">ADD A,$03</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e91f"></span>E91F</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B'</span>=0, 1 or 2 (the column of the character's sprite at (X,Y))</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e920"></span>E920</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=5*<span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e921"></span>E921</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e922"></span>E922</td>
<td class="instruction">ADD A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e923"></span>E923</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B'</span>=0, 5 or 10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e924"></span>E924</td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x02 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e926"></span>E926</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e927"></span>E927</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e928"></span>E928</td>
<td class="instruction">CP $05</td>
<td class="comment-11" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e92a"></span>E92A</td>
<td class="instruction">JR $E95C</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e92c"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is congruent to 7 mod 8, which means he has a sprite with 3 rows and 5 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e92c"></span>E92C</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e92d"></span>E92D</td>
<td class="instruction">CP $05</td>
<td class="comment-11" rowspan="1">Does any part of the character impinge on column X?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e92f"></span>E92F</td>
<td class="instruction">JR NC,$E95E</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e931"></span>E931</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L'</span>=0x00</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e932"></span>E932</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e934"></span>E934</td>
<td class="instruction">JR Z,$E939</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e936"></span>E936</td>
<td class="instruction">CPL</td>
<td class="comment-11" rowspan="2">Set <span class="register">A</span>=4-<span class="register">A</span> if the character is facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e937"></span>E937</td>
<td class="instruction">ADD A,$05</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e939"></span>E939</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B'</span>=0, 1, 2, 3 or 4 (the column of the sprite at (X,Y))</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e93a"></span>E93A</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=3*<span class="register">B'</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e93b"></span>E93B</td>
<td class="instruction">ADD A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e93c"></span>E93C</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B'</span>=0, 3, 6, 9 or 12</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e93d"></span>E93D</td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x02 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e93f"></span>E93F</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e940"></span>E940</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e941"></span>E941</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e943"></span>E943</td>
<td class="instruction">JR $E95C</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e945"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is &gt;= 0x78, which means he has a sprite with 2 rows and 2 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e945"></span>E945</td>
<td class="instruction">LD L,$01</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x01 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e947"></span>E947</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=X, the play area x-coordinate (0-255)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e948"></span>E948</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e949"></span>E949</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="1">Does any part of the sprite impinge on column X?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e94b"></span>E94B</td>
<td class="instruction">JR NC,$E95E</td>
<td class="comment-11" rowspan="1">Consider the next character if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e94d"></span>E94D</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L'</span>=0x00</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e94e"></span>E94E</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e950"></span>E950</td>
<td class="instruction">JR Z,$E954</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e952"></span>E952</td>
<td class="instruction">XOR $01</td>
<td class="comment-11" rowspan="1">Set <span class="register">A</span>=1-<span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e954"></span>E954</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0 or 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e955"></span>E955</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B'</span>=0 or 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e956"></span>E956</td>
<td class="instruction">LD L,$02</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x02 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e958"></span>E958</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e959"></span>E959</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e95a"></span>E95A</td>
<td class="instruction">CP $02</td>
<td class="comment-11" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e95c"></span>E95C</td>
<td class="instruction">JR C,$E966</td>
<td class="comment-11" rowspan="1">Jump if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e95e"></span>E95E</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Next character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e95f"></span>E95F</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e960"></span>E960</td>
<td class="instruction">CP $E7</td>
<td class="comment-11" rowspan="1">Have we done all the characters (0xD7-0xE6)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e962"></span>E962</td>
<td class="instruction">JR NZ,$E8FC</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e964"></span>E964</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e965"></span>E965</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e966"></span>
<div class="comments">
<div class="paragraph">
The character's sprite impinges on the tile at coordinates (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e966"></span>E966</td>
<td class="instruction">ADD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0-14 (index of the sprite tile at (X,Y))</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e967"></span>E967</td>
<td class="instruction">ADD A,$D7</td>
<td class="comment-11" rowspan="1">0xD7&lt;=<span class="register">A</span>&lt;=0xE5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e969"></span>E969</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e96a"></span>E96A</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">0xD7&lt;=<span class="register">H</span>&lt;=0xE5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e96b"></span>E96B</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e96c"></span>E96C</td>
<td class="instruction">LD L,$00</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL'</span> at byte 0x00 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e96e"></span>E96E</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e96f"></span>E96F</td>
<td class="instruction">AND $07</td>
<td class="comment-11" rowspan="1">Keep only bits 0-2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e971"></span>E971</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e972"></span>E972</td>
<td class="instruction">JR NZ,$E976</td>
<td class="comment-11" rowspan="1">Jump if the animatory state is congruent to 1-7 mod 8</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e974"></span>E974</td>
<td class="instruction">ADD A,$02</td>
<td class="comment-11" rowspan="1">Add 2 if the animatory state is congruent to 0 mod 8</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e976"></span>E976</td>
<td class="instruction">OR $80</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>&gt;=0x81</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e978"></span>E978</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e979"></span>E979</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>&gt;=0x81, 0xD7&lt;=<span class="register">H</span>&lt;=0xE5</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e97a"></span>E97A</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sprite tile reference (0x00-0xD6, 0xD9-0xFF)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e97b"></span>E97B</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e97c"></span>E97C</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Set the zero flag if this is the blank tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e97d"></span>E97D</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e97e"></span>E97E</td>
<td class="instruction">JR Z,$E95E</td>
<td class="comment-11" rowspan="1">Jump back to consider the next character if the sprite tile is blank</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e980"></span>
<div class="comments">
<div class="paragraph">
A tile of this character's sprite needs to be printed at (X,Y). The apparent intention of the next section of code is to treat animatory states <a href="../graphics/as.html#120">0x78-0x7F/0xF8-0xFF</a> (used only by the hook) specially, but the next instruction copies <span class="register">L'</span> (which holds 0) instead of <span class="register">L</span> (which holds the adjusted animatory state) into <span class="register">A</span>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e980"></span>E980</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e981"></span>E981</td>
<td class="instruction">CP $F8</td>
<td class="comment-11" rowspan="1">This instruction sets the carry flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e983"></span>E983</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e984"></span>E984</td>
<td class="instruction">JR C,$E98F</td>
<td class="comment-11" rowspan="1">This jump is always made</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e986"></span>
<div class="comments">
<div class="paragraph">
The next section of code is never executed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e986"></span>E986</td>
<td class="instruction">LD H,$DB</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at one of the eight bytes at <a href="DBF8.html">DBF8</a> (which are all zero)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e988"></span>E988</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e989"></span>E989</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Set the zero flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e98a"></span>E98A</td>
<td class="instruction">JR Z,$E98F</td>
<td class="comment-11" rowspan="1">This jump would always be made</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e98c"></span>E98C</td>
<td class="instruction">LD ($A81E),A</td>
<td class="comment-11" rowspan="1">Update the attribute byte stored at <a href="A81E.html">A81E</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e98f"></span>
<div class="comments">
<div class="paragraph">
Normal service resumes here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e98f"></span>E98F</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e990"></span>E990</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e991"></span>E991</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e992"></span>E992</td>
<td class="instruction">LD D,$C7</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the graphic data for the sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e994"></span>E994</td>
<td class="instruction">LD HL,$A01E</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the back buffer at <a href="A01E.html">A01E</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e997"></span>E997</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="1">Is the character facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e998"></span>E998</td>
<td class="instruction">JR C,$E9A9</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e99a"></span>
<div class="comments">
<div class="paragraph">
The character is facing left, so we can use the tile as-is (there is no need to flip it).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e99a"></span>E99A</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Now <span class="register">DE</span> points at the back buffer, and <span class="register">HL</span> points at the graphic data for the sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e99b"></span>E99B</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up a graphic byte from the back buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e99c"></span>E99C</td>
<td class="instruction">OR (HL)</td>
<td class="comment-11" rowspan="1">OR on the sprite tile graphic byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e99d"></span>E99D</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the sprite tile mask byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e99e"></span>E99E</td>
<td class="instruction">AND (HL)</td>
<td class="comment-11" rowspan="1">AND on the sprite tile mask byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e99f"></span>E99F</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Update the back buffer byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a0"></span>E9A0</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the next graphic byte of the sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a1"></span>E9A1</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the next byte of the back buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a2"></span>E9A2</td>
<td class="instruction">BIT 3,D</td>
<td class="comment-11" rowspan="1">Have we finished all 8 bytes?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a4"></span>E9A4</td>
<td class="instruction">JR Z,$E99B</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a6"></span>E9A6</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">This instruction is redundant</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9a7"></span>E9A7</td>
<td class="instruction">JR $E9BC</td>
<td class="comment-11" rowspan="1">Consider the next character</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="e9a9"></span>
<div class="comments">
<div class="paragraph">
The character is facing right, so we need to flip the tile.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e9a9"></span>E9A9</td>
<td class="instruction">LD B,$7E</td>
<td class="comment-11" rowspan="1">The table of mirror bytes is in <a href="7E00.html">page 0x7E</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e9ab"></span>E9AB</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick up a sprite tile graphic byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9ac"></span>E9AC</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Copy it to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9ad"></span>E9AD</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mirror image of the sprite tile graphic byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9ae"></span>E9AE</td>
<td class="instruction">OR (HL)</td>
<td class="comment-11" rowspan="1">OR on the back buffer graphic byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9af"></span>E9AF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store the result in the back buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b0"></span>E9B0</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the sprite tile mask byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b1"></span>E9B1</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b2"></span>E9B2</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Copy it to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b3"></span>E9B3</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mirror image of the sprite tile mask byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b4"></span>E9B4</td>
<td class="instruction">AND (HL)</td>
<td class="comment-11" rowspan="1">AND on the back buffer graphic byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b5"></span>E9B5</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store the result in the back buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b6"></span>E9B6</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the next graphic byte of the sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b7"></span>E9B7</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the next byte of the back buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9b8"></span>E9B8</td>
<td class="instruction">BIT 3,H</td>
<td class="comment-11" rowspan="1">Have we finished all 8 bytes?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9ba"></span>E9BA</td>
<td class="instruction">JR Z,$E9AB</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="e9bc"></span>E9BC</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="e9bd"></span>E9BD</td>
<td class="instruction">JR $E95E</td>
<td class="comment-11" rowspan="1">Jump back to consider the next character</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="E8F0.html">E8F0</a></span></td>
<td class="up">Up: <a href="../maps/all.html#e8f3">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="E9BF.html">E9BF</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20181020</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2018 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
<div><a href="http://skoolkit.ca/disassemblies/contact_sam_cruise/asm/59635.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>