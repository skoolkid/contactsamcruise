<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 56576</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="start-Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo.png" /></a></td>
<td class="page-header">Startup routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="56064.html">56064</a>
</td>
<td class="up">Up: <a href="start.html#56576">Map</a></td>
<td class="next">
</td>
</tr>
</table>
<div class="description">56576: Prepare the bottom 4 lines of the screen</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="../asm/61630.html">61630</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="56576"></span>56576</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="56577"></span>56577</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="56578"></span>56578</td>
<td class="instruction">NOP</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="56579"></span>56579</td>
<td class="instruction">LD H,80</td>
<td class="comment-1" rowspan="9">Clear the bottom 4 lines (32 pixel rows) of the display file</td>
</tr>
<tr>
<td class="address-2"><span id="56581"></span>56581</td>
<td class="instruction">LD L,128</td>
</tr>
<tr>
<td class="address-1"><span id="56583"></span>56583</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address-2"><span id="56584"></span>56584</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="56585"></span>56585</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56586"></span>56586</td>
<td class="instruction">JR NZ,56584</td>
</tr>
<tr>
<td class="address-1"><span id="56588"></span>56588</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="56589"></span>56589</td>
<td class="instruction">BIT 3,H</td>
</tr>
<tr>
<td class="address-1"><span id="56591"></span>56591</td>
<td class="instruction">JR Z,56581</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="56593"></span>
<div class="comments">
<div class="paragraph">
Now the first 24 character squares on each of the bottom 3 lines (24 pixel rows) of the screen are filled with graphic data. The 576 bytes of graphic data are copied to the screen from the following 5 segments:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Length</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="55040.html">55040</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="55296.html">55296</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="55552.html">55552</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="55808.html">55808</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a href="56064.html">56064</a></td>
<td class="" colspan="1" rowspan="1">72 bytes</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="56593"></span>56593</td>
<td class="instruction">LD HL,55040</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the first byte to be copied to the screen</td>
</tr>
<tr>
<td class="address-1"><span id="56596"></span>56596</td>
<td class="instruction">LD DE,20640</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the first display file location to be written</td>
</tr>
<tr>
<td class="address-1"><span id="56599"></span>56599</td>
<td class="instruction">LD C,24</td>
<td class="comment-1" rowspan="1">There are 24 bytes per row of pixels</td>
</tr>
<tr>
<td class="address-2"><span id="56601"></span>56601</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save the display file pointer</td>
</tr>
<tr>
<td class="address-1"><span id="56602"></span>56602</td>
<td class="instruction">LD B,24</td>
<td class="comment-1" rowspan="1">There are 24 rows of pixels to be drawn</td>
</tr>
<tr>
<td class="address-2"><span id="56604"></span>56604</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up a byte to copy</td>
</tr>
<tr>
<td class="address-1"><span id="56605"></span>56605</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Copy the byte to the screen</td>
</tr>
<tr>
<td class="address-1"><span id="56606"></span>56606</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Move <span class="register">HL</span> along to the next byte to copy</td>
</tr>
<tr>
<td class="address-1"><span id="56607"></span>56607</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="2">Have we reached the end of a segment?</td>
</tr>
<tr>
<td class="address-1"><span id="56608"></span>56608</td>
<td class="instruction">SUB 126</td>
</tr>
<tr>
<td class="address-1"><span id="56610"></span>56610</td>
<td class="instruction">JR NZ,56614</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="56612"></span>56612</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the first byte in the next segment</td>
</tr>
<tr>
<td class="address-1"><span id="56613"></span>56613</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-2"><span id="56614"></span>56614</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next pixel row down on the screen</td>
</tr>
<tr>
<td class="address-1"><span id="56615"></span>56615</td>
<td class="instruction">BIT 3,D</td>
<td class="comment-1" rowspan="1">Have we just copied a byte to the 8th or 16th row of pixels?</td>
</tr>
<tr>
<td class="address-1"><span id="56617"></span>56617</td>
<td class="instruction">JR Z,56625</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="56619"></span>56619</td>
<td class="instruction">LD D,80</td>
<td class="comment-1" rowspan="4">Otherwise point <span class="register">DE</span> at the 9th or 17th row of pixels</td>
</tr>
<tr>
<td class="address-1"><span id="56621"></span>56621</td>
<td class="instruction">LD A,E</td>
</tr>
<tr>
<td class="address-1"><span id="56622"></span>56622</td>
<td class="instruction">ADD A,32</td>
</tr>
<tr>
<td class="address-1"><span id="56624"></span>56624</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-2"><span id="56625"></span>56625</td>
<td class="instruction">DJNZ 56604</td>
<td class="comment-1" rowspan="1">Jump back until a column of 24 bytes has been copied</td>
</tr>
<tr>
<td class="address-1"><span id="56627"></span>56627</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the display file pointer</td>
</tr>
<tr>
<td class="address-1"><span id="56628"></span>56628</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the top byte in the next column along</td>
</tr>
<tr>
<td class="address-1"><span id="56629"></span>56629</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Have we finished all 24 columns?</td>
</tr>
<tr>
<td class="address-1"><span id="56630"></span>56630</td>
<td class="instruction">JR NZ,56601</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="56632"></span>
<div class="comments">
<div class="paragraph">
Now that the bottom 4 lines of the display file are ready, it's time to prepare the bottom 4 lines of the attribute file.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="56632"></span>56632</td>
<td class="instruction">LD HL,23168</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the first attribute byte of the line where on-screen messages will be displayed</td>
</tr>
<tr>
<td class="address-1"><span id="56635"></span>56635</td>
<td class="instruction">LD B,32</td>
<td class="comment-1" rowspan="1">There are 32 attribute bytes in this line</td>
</tr>
<tr>
<td class="address-2"><span id="56637"></span>56637</td>
<td class="instruction">LD (HL),15</td>
<td class="comment-1" rowspan="3">Set each attribute byte to 15 (INK 7: PAPER 1)</td>
</tr>
<tr>
<td class="address-1"><span id="56639"></span>56639</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56640"></span>56640</td>
<td class="instruction">DJNZ 56637</td>
</tr>
<tr>
<td class="address-1"><span id="56642"></span>56642</td>
<td class="instruction">LD C,3</td>
<td class="comment-1" rowspan="1">There are 3 lines at the bottom of the screen that still need their attribute bytes set</td>
</tr>
<tr>
<td class="address-2"><span id="56644"></span>56644</td>
<td class="instruction">LD B,8</td>
<td class="comment-1" rowspan="1">The first 8 bytes in each line correspond to the Contact Sam Cruise logo</td>
</tr>
<tr>
<td class="address-2"><span id="56646"></span>56646</td>
<td class="instruction">LD (HL),23</td>
<td class="comment-1" rowspan="3">Set these attribute bytes to 23 (INK 7: PAPER 2)</td>
</tr>
<tr>
<td class="address-1"><span id="56648"></span>56648</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56649"></span>56649</td>
<td class="instruction">DJNZ 56646</td>
</tr>
<tr>
<td class="address-1"><span id="56651"></span>56651</td>
<td class="instruction">LD B,12</td>
<td class="comment-1" rowspan="1">The next 12 bytes in each line correspond to the icon panel</td>
</tr>
<tr>
<td class="address-2"><span id="56653"></span>56653</td>
<td class="instruction">LD (HL),54</td>
<td class="comment-1" rowspan="3">Set these attribute bytes to 54 (INK 6: PAPER 6)</td>
</tr>
<tr>
<td class="address-1"><span id="56655"></span>56655</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56656"></span>56656</td>
<td class="instruction">DJNZ 56653</td>
</tr>
<tr>
<td class="address-1"><span id="56658"></span>56658</td>
<td class="instruction">LD B,9</td>
<td class="comment-1" rowspan="1">The next 9 bytes in each line correspond to the score box</td>
</tr>
<tr>
<td class="address-2"><span id="56660"></span>56660</td>
<td class="instruction">LD (HL),32</td>
<td class="comment-1" rowspan="3">Set these attribute bytes to 32 (INK 0: PAPER 4)</td>
</tr>
<tr>
<td class="address-1"><span id="56662"></span>56662</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56663"></span>56663</td>
<td class="instruction">DJNZ 56660</td>
</tr>
<tr>
<td class="address-1"><span id="56665"></span>56665</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1">The last 3 bytes in each line correspond to the disguise box</td>
</tr>
<tr>
<td class="address-2"><span id="56667"></span>56667</td>
<td class="instruction">LD (HL),23</td>
<td class="comment-1" rowspan="3">Set these attribute bytes to 23 (INK 7: PAPER 2)</td>
</tr>
<tr>
<td class="address-1"><span id="56669"></span>56669</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="56670"></span>56670</td>
<td class="instruction">DJNZ 56667</td>
</tr>
<tr>
<td class="address-1"><span id="56672"></span>56672</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Have we done all 3 lines at the bottom of the screen?</td>
</tr>
<tr>
<td class="address-1"><span id="56673"></span>56673</td>
<td class="instruction">JR NZ,56644</td>
<td class="comment-1" rowspan="1">Jump back to do the next line if not</td>
</tr>
<tr>
<td class="address-1"><span id="56675"></span>56675</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="56064.html">56064</a>
</td>
<td class="up">Up: <a href="start.html#56576">Map</a></td>
<td class="next">
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20191116</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../start/DD00.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>