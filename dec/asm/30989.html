<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 30989</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30972.html">30972</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30989">Map</a></td>
<td class="next">
Next: <a href="31100.html">31100</a>
</td>
</tr>
</table>
<div class="description">30989: Display a cutscene</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="31414.html">31414</a>. Displays a cutscene, and then enters demo mode or resumes the game in the next mode.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Cutscene message number</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="30989"></span>30989</td>
<td class="instruction">LD (32722),A</td>
<td class="comment-1" rowspan="1">Store the cutscene message number at <a href="32722.html">32722</a> so that it can be monitored</td>
</tr>
<tr>
<td class="address-1"><span id="30992"></span>30992</td>
<td class="instruction">CALL <a href="28357.html">28357</a></td>
<td class="comment-1" rowspan="1">Add the message to the message queue</td>
</tr>
<tr>
<td class="address-1"><span id="30995"></span>30995</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="30996"></span>30996</td>
<td class="instruction">LD (32713),A</td>
<td class="comment-1" rowspan="1">Set Sam's disguise ID (stored at <a href="32713.html">32713</a>) to 0 (none)</td>
</tr>
<tr>
<td class="address-1"><span id="30999"></span>30999</td>
<td class="instruction">LD (32666),A</td>
<td class="comment-1" rowspan="1">Disconnect any phone call Sam may be making by setting <a href="32666.html">32666</a> to 0</td>
</tr>
<tr>
<td class="address-1"><span id="31002"></span>31002</td>
<td class="instruction">LD (32764),A</td>
<td class="comment-1" rowspan="1">Clear all of Sam's status flags at <a href="32764.html">32764</a></td>
</tr>
<tr>
<td class="address-1"><span id="31005"></span>31005</td>
<td class="instruction">CALL <a href="63838.html#63849">63849</a></td>
<td class="comment-1" rowspan="1">Update Sam's sprite and the disguise icon now that Sam's wearing no disguise</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31008"></span>
<div class="comments">
<div class="paragraph">
The loop that follows makes Sam pace up and down until the cutscene is over.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31008"></span>31008</td>
<td class="instruction">LD HL,58889</td>
<td class="comment-1" rowspan="3">Reset the midstride/mid-action timer in byte 9 of Sam's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31011"></span>31011</td>
<td class="instruction">XOR A</td>
</tr>
<tr>
<td class="address-1"><span id="31012"></span>31012</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31013"></span>31013</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="31014"></span>31014</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is Sam midstride?</td>
</tr>
<tr>
<td class="address-1"><span id="31016"></span>31016</td>
<td class="instruction">JR Z,31058</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31018"></span>31018</td>
<td class="instruction">CALL <a href="59848.html">59848</a></td>
<td class="comment-1" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="31021"></span>31021</td>
<td class="instruction">DEC E</td>
<td class="comment-1" rowspan="5">Set <span class="register">E</span> to Sam's next x-coordinate (immediately in front of him)</td>
</tr>
<tr>
<td class="address-1"><span id="31022"></span>31022</td>
<td class="instruction">BIT 7,A</td>
</tr>
<tr>
<td class="address-1"><span id="31024"></span>31024</td>
<td class="instruction">JR Z,31028</td>
</tr>
<tr>
<td class="address-1"><span id="31026"></span>31026</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address-1"><span id="31027"></span>31027</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address-2"><span id="31028"></span>31028</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="2">Set <span class="register">A</span> to Sam's new animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="31029"></span>31029</td>
<td class="instruction">AND 251</td>
</tr>
<tr>
<td class="address-2"><span id="31031"></span>31031</td>
<td class="instruction">CALL <a href="59861.html">59861</a></td>
<td class="comment-1" rowspan="1">Update Sam's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="address-1"><span id="31034"></span>31034</td>
<td class="instruction">CALL <a href="60521.html">60521</a></td>
<td class="comment-1" rowspan="1">Make a walking sound effect</td>
</tr>
<tr>
<td class="address-1"><span id="31037"></span>31037</td>
<td class="instruction">CALL <a href="60032.html">60032</a></td>
<td class="comment-1" rowspan="1">Update the display</td>
</tr>
<tr>
<td class="address-1"><span id="31040"></span>31040</td>
<td class="instruction">CALL <a href="28357.html#28404">28404</a></td>
<td class="comment-1" rowspan="1">Update the message line</td>
</tr>
<tr>
<td class="address-1"><span id="31043"></span>31043</td>
<td class="instruction">LD HL,32712</td>
<td class="comment-1" rowspan="1"><a href="32712.html">32712</a> holds the value of the LSB of the system variable FRAMES as it was at the end of the last pass through the main loop (or this routine)</td>
</tr>
<tr>
<td class="address-2"><span id="31046"></span>31046</td>
<td class="instruction">LD A,(23672)</td>
<td class="comment-1" rowspan="4">Wait about 240ms</td>
</tr>
<tr>
<td class="address-1"><span id="31049"></span>31049</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="31050"></span>31050</td>
<td class="instruction">CP 12</td>
</tr>
<tr>
<td class="address-1"><span id="31052"></span>31052</td>
<td class="instruction">JR C,31046</td>
</tr>
<tr>
<td class="address-1"><span id="31054"></span>31054</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="2">Store the current value of the LSB of the system variable FRAMES at <a href="32712.html">32712</a> for comparison next time</td>
</tr>
<tr>
<td class="address-1"><span id="31055"></span>31055</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="31056"></span>31056</td>
<td class="instruction">JR 31008</td>
<td class="comment-1" rowspan="1">Jump back to the beginning of this loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31058"></span>
<div class="comments">
<div class="paragraph">
Sam is not midstride at the moment.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31058"></span>31058</td>
<td class="instruction">CALL <a href="29668.html">29668</a></td>
<td class="comment-1" rowspan="1">Show or hide the fuse, door, light bulb or phone in the icon panel</td>
</tr>
<tr>
<td class="address-1"><span id="31061"></span>31061</td>
<td class="instruction">CALL <a href="30972.html">30972</a></td>
<td class="comment-1" rowspan="1">Has the entire cutscene message been displayed yet?</td>
</tr>
<tr>
<td class="address-1"><span id="31064"></span>31064</td>
<td class="instruction">JP NZ,<a href="61630.html">61630</a></td>
<td class="comment-1" rowspan="1">Jump if so to end the cutscene</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31067"></span>
<div class="comments">
<div class="paragraph">
The cutscene is not over yet. Check whether Sam should turn round before pacing up or down again.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="31067"></span>31067</td>
<td class="instruction">LD HL,58881</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of Sam's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="31070"></span>31070</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="31071"></span>31071</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="31072"></span>31072</td>
<td class="instruction">AND 7</td>
<td class="comment-1" rowspan="1">Is Sam's x-coordinate exactly divisible by 8?</td>
</tr>
<tr>
<td class="address-1"><span id="31074"></span>31074</td>
<td class="instruction">JR NZ,31087</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31076"></span>31076</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is Sam facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="31078"></span>31078</td>
<td class="instruction">JR NZ,31095</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-2"><span id="31080"></span>31080</td>
<td class="instruction">CALL <a href="59848.html">59848</a></td>
<td class="comment-1" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="31083"></span>31083</td>
<td class="instruction">XOR 128</td>
<td class="comment-1" rowspan="1">Flip bit 7 of Sam's animatory state, thus turning him round</td>
</tr>
<tr>
<td class="address-1"><span id="31085"></span>31085</td>
<td class="instruction">JR 31031</td>
<td class="comment-1" rowspan="1">Jump back to update Sam's animatory state and the SRB</td>
</tr>
<tr>
<td class="address-2"><span id="31087"></span>31087</td>
<td class="instruction">CP 5</td>
<td class="comment-1" rowspan="1">Is Sam's x-coordinate congruent to 5 mod 8?</td>
</tr>
<tr>
<td class="address-1"><span id="31089"></span>31089</td>
<td class="instruction">JR NZ,31095</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="31091"></span>31091</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is Sam facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="31093"></span>31093</td>
<td class="instruction">JR NZ,31080</td>
<td class="comment-1" rowspan="1">Jump back to turn Sam round if so</td>
</tr>
<tr>
<td class="address-2"><span id="31095"></span>31095</td>
<td class="instruction">CALL <a href="59848.html">59848</a></td>
<td class="comment-1" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="address-1"><span id="31098"></span>31098</td>
<td class="instruction">JR 31028</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="30972.html">30972</a>
</td>
<td class="up">Up: <a href="../maps/all.html#30989">Map</a></td>
<td class="next">
Next: <a href="31100.html">31100</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20221122</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/790D.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>