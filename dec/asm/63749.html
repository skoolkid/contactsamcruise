<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 63749</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63662.html">63662</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63749">Map</a></td>
<td class="next">
Next: <a href="63774.html">63774</a>
</td>
</tr>
</table>
<div class="description">63749: Check whether a character is in the correct spot to enter a building</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="60812.html">60812</a>. The character in question is standing outside the entrance to a shop or other building, and his destination is somewhere inside. This routine returns with the zero flag set if the character is standing in the correct spot (and facing the right way) to enter the building or knock on the door; otherwise it returns with the zero flag reset, and the carry flag reset if the character should move left, or set if he should move right in order to reach the correct spot.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">x-coordinate of the right edge of the doorway</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="63749"></span>63749</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="63751"></span>63751</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x-coordinate of the right edge of the doorway</td>
</tr>
<tr>
<td class="address-1"><span id="63752"></span>63752</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare this with the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="63753"></span>63753</td>
<td class="instruction">JR NZ,63763</td>
<td class="comment-1" rowspan="1">Jump unless they match</td>
</tr>
<tr>
<td class="address-1"><span id="63755"></span>63755</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is the character's x-coordinate 0 (meaning he is standing at the doorway of the shop at the far left of town)?</td>
</tr>
<tr>
<td class="address-1"><span id="63756"></span>63756</td>
<td class="instruction">JR Z,63767</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="63758"></span>63758</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="63759"></span>63759</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Set the zero flag if the character is facing left</td>
</tr>
<tr>
<td class="address-1"><span id="63761"></span>63761</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="63762"></span>63762</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return with the zero flag set if the character is facing left (he can enter or knock now); otherwise return with the zero flag reset and the carry flag reset (he should turn round first)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63763"></span>
<div class="comments">
<div class="paragraph">
The character is not standing at the right edge of the doorway. Is he standing at the left edge?
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63763"></span>63763</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">D</span>-1 (x-coordinate of the left edge of the doorway)</td>
</tr>
<tr>
<td class="address-1"><span id="63764"></span>63764</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare this with the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="63765"></span>63765</td>
<td class="instruction">CCF</td>
<td class="comment-1" rowspan="1">Set the carry flag if the character's x-coordinate is less than <span class="register">D</span></td>
</tr>
<tr>
<td class="address-1"><span id="63766"></span>63766</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return with the zero flag reset (and the carry flag reset if the character's x-coordinate is at least <span class="register">D</span>, set if it's less than <span class="register">D</span>-1) if the character is not standing at the left edge of the doorway</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="63767"></span>
<div class="comments">
<div class="paragraph">
The character is either standing at the doorway of the shop at the far left of town (at x-coordinate 0), or standing at the left edge of some other doorway.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="63767"></span>63767</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="63768"></span>63768</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="63769"></span>63769</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="address-1"><span id="63770"></span>63770</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="3">Set the zero flag if the character is facing right; otherwise reset the zero flag and set the carry flag (the character should turn round first)</td>
</tr>
<tr>
<td class="address-1"><span id="63771"></span>63771</td>
<td class="instruction">CCF</td>
</tr>
<tr>
<td class="address-1"><span id="63772"></span>63772</td>
<td class="instruction">SBC A,A</td>
</tr>
<tr>
<td class="address-1"><span id="63773"></span>63773</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="63662.html">63662</a>
</td>
<td class="up">Up: <a href="../maps/all.html#63749">Map</a></td>
<td class="next">
Next: <a href="63774.html">63774</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20200812</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/F905.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>