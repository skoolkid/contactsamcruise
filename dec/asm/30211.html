<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 30211</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30198.html">30198</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30211">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30396.html">30396</a></span></td>
</tr>
</table>
<div class="description">30211: Check whether Sam has found something and update the icon panel</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="31204.html">31204</a> and <a href="61568.html">61568</a>. Scans the object location table at <a href="32028.html">32028</a> to check whether Sam has found the hook, the budgie, a key, some money, or a location that requires a message to be displayed, and then updates the icon panel appropriately.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30211"></span>30211</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,58881</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30214"></span>30214</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30215"></span>30215</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30216"></span>30216</td>
<td class="bytes-0"></td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=Sam's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30217"></span>30217</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32028</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the object location table at <a href="32028.html">32028</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30220"></span>30220</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Collect the first byte of an entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30221"></span>30221</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Have we reached the end of the table?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30222"></span>30222</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30268</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30224"></span>30224</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> to the second byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30225"></span>30225</td>
<td class="bytes-0"></td>
<td class="instruction">AND 2</td>
<td class="comment-11" rowspan="1">Is this entry active?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30227"></span>30227</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30239</td>
<td class="comment-11" rowspan="1">Proceed to the next entry if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30229"></span>30229</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the object</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30230"></span>30230</td>
<td class="bytes-0"></td>
<td class="instruction">CP C</td>
<td class="comment-11" rowspan="1">Is Sam's x-coordinate the same?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30231"></span>30231</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30239</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30233"></span>30233</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> to the third byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30234"></span>30234</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=y-coordinate of the object</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30235"></span>30235</td>
<td class="bytes-0"></td>
<td class="instruction">CP B</td>
<td class="comment-11" rowspan="1">Set the zero flag if Sam's y-coordinate is the same</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30236"></span>30236</td>
<td class="bytes-0"></td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> back to the second byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30237"></span>30237</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30244</td>
<td class="comment-11" rowspan="1">Jump if Sam's coordinates match the object's</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30239"></span>30239</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the first byte of the next entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30240"></span>30240</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30241"></span>30241</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30242"></span>30242</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30220</td>
<td class="comment-11" rowspan="1">Jump back to check the next entry</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30244"></span>
<div class="comments">
<div class="paragraph">
Sam's coordinates match those of the object. Is it the hook or the budgie?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30244"></span>30244</td>
<td class="bytes-0"></td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> back to the first byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30245"></span>30245</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Is this entry for an object that can be picked up (i.e. the hook or the budgie)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30247"></span>30247</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30271</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30249"></span>30249</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(58880)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30252"></span>30252</td>
<td class="bytes-0"></td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">Discard bit 7 (the direction bit)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30254"></span>30254</td>
<td class="bytes-0"></td>
<td class="instruction">CP 6</td>
<td class="comment-11" rowspan="1"><a href="../graphics/as.html#6">6</a>: Is Sam bending his knees?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30256"></span>30256</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30270</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30258"></span>30258</td>
<td class="bytes-0"></td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Increment the first byte of the entry (thus deactivating it)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30259"></span>30259</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the fourth byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30260"></span>30260</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30261"></span>30261</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30262"></span>30262</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the fourth byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30263"></span>30263</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32745</td>
<td class="comment-11" rowspan="3">Set the appropriate bit at <a href="32745.html">32745</a> to give Sam the object</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30266"></span>30266</td>
<td class="bytes-0"></td>
<td class="instruction">OR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30267"></span>30267</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30268"></span>30268</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30339</td>
<td class="comment-11" rowspan="1">Jump forward to update the icon panel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30270"></span>30270</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement the first byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30271"></span>30271</td>
<td class="bytes-0"></td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Increment the first byte of the entry (thus deactivating it if it's not the hook or the budgie)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30272"></span>30272</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=first byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30273"></span>30273</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the fourth byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30274"></span>30274</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30275"></span>30275</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30276"></span>30276</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the object table entry pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30277"></span>30277</td>
<td class="bytes-0"></td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save Sam's coordinates</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30278"></span>30278</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 6,A</td>
<td class="comment-11" rowspan="1">Is this entry for an object that can be picked up (i.e. the hook or the budgie)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30280"></span>30280</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30292</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30282"></span>30282</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=fourth byte of the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30283"></span>30283</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32680</td>
<td class="comment-11" rowspan="2">Store the object ID at <a href="32680.html">32680</a> for now</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30286"></span>30286</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30287"></span>30287</td>
<td class="bytes-0"></td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore Sam's coordinates to <span class="register">BC</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30288"></span>30288</td>
<td class="bytes-0"></td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the object table entry pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30289"></span>30289</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first byte of the next entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30290"></span>30290</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30220</td>
<td class="comment-11" rowspan="1">Jump back to check the next entry</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30292"></span>
<div class="comments">
<div class="paragraph">
It's not the hook or the budgie. Does a message need to be displayed?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30292"></span>30292</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 5,A</td>
<td class="comment-11" rowspan="1">Is this entry for a message that needs to be displayed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30294"></span>30294</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30302</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30296"></span>30296</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=message number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30297"></span>30297</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="28357.html">28357</a></td>
<td class="comment-11" rowspan="1">Queue the message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30300"></span>30300</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30287</td>
<td class="comment-11" rowspan="1">Jump back to check the next entry</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30302"></span>
<div class="comments">
<div class="paragraph">
It's not the hook, the budgie or a message. Is it a key?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30302"></span>30302</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 4,A</td>
<td class="comment-11" rowspan="1">Is this entry for a key?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30304"></span>30304</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30321</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30306"></span>30306</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=key identifier (8, 16, 32 or 64)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30307"></span>30307</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32746</td>
<td class="comment-11" rowspan="3">Set the appropriate bit at <a href="32746.html">32746</a>, thus giving Sam the key</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30310"></span>30310</td>
<td class="bytes-0"></td>
<td class="instruction">OR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30311"></span>30311</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30312"></span>30312</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,100</td>
<td class="comment-11" rowspan="1">$100 to add to Sam's cash supply</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30314"></span>30314</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30322</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30316"></span>30316</td>
<td class="bytes-0"></td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="3">This block of code is never executed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30317"></span>30317</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30319"></span>30319</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30332</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30321"></span>
<div class="comments">
<div class="paragraph">
If it's not the hook, the budgie, a message or a key, it must be cash.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30321"></span>30321</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of bucks</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30322"></span>30322</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="28295.html#28306">28306</a></td>
<td class="comment-11" rowspan="1">Add this to Sam's total</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30325"></span>30325</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,5126</td>
<td class="comment-11" rowspan="3">Prepare the cash bonus sound effect parameters</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30328"></span>30328</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,144</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30330"></span>30330</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30332"></span>30332</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,2</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30334"></span>30334</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="30053.html">30053</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30337"></span>30337</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30287</td>
<td class="comment-11" rowspan="1">Jump back to check the next entry</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30339"></span>
<div class="comments">
<div class="paragraph">
Now we set the attribute bytes for the budgie and hook in the icon panel.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30339"></span>30339</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32680</td>
<td class="comment-11" rowspan="1"><a href="32680.html">32680</a> holds the ID of the object Sam is standing next to (if any)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30342"></span>30342</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=object ID</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30343"></span>30343</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),0</td>
<td class="comment-11" rowspan="1">Reset <a href="32680.html">32680</a> to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30345"></span>30345</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,233</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="32745.html">32745</a> (object inventory)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30347"></span>30347</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=object inventory flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30348"></span>30348</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=ID of the object Sam is standing next to (if any)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30349"></span>30349</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,176</td>
<td class="comment-11" rowspan="1">176 is the LSB of 23216 (the attribute file address for the top-left tile of the budgie icon)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30351"></span>30351</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,1538</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=6, <span class="register">C</span>=2 (2 objects: budgie and hook)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30354"></span>30354</td>
<td class="bytes-0"></td>
<td class="instruction">RL L</td>
<td class="comment-11" rowspan="2">Move an object ID bit (if any) into bit 0 of <span class="register">H</span>, and an object inventory flag into the carry flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30356"></span>30356</td>
<td class="bytes-0"></td>
<td class="instruction">RL H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30358"></span>30358</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,48</td>
<td class="comment-11" rowspan="1">48=PAPER 6: INK 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30360"></span>30360</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,30368</td>
<td class="comment-11" rowspan="1">Jump if Sam already has this object</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30362"></span>30362</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=56 (INK 6: PAPER 6)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30363"></span>30363</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 0,H</td>
<td class="comment-11" rowspan="1">Is Sam standing next to this object?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30365"></span>30365</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30368</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30367"></span>30367</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=6 (INK 6: PAPER 0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30368"></span>30368</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="28703.html#28709">28709</a></td>
<td class="comment-11" rowspan="1">Set the attribute bytes for the object in the icon panel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30371"></span>30371</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,178</td>
<td class="comment-11" rowspan="1">178 is the LSB of 23218 (the attribute file address for the top-left tile of the hook icon)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30373"></span>30373</td>
<td class="bytes-0"></td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Have we dealt with both objects yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30374"></span>30374</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30354</td>
<td class="comment-11" rowspan="1">Jump back to deal with the second object if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30376"></span>
<div class="comments">
<div class="paragraph">
Now we display the keys Sam has found.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30376"></span>30376</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32746)</td>
<td class="comment-11" rowspan="1">Pick up the key inventory flags from <a href="32746.html">32746</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30379"></span>30379</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1">Move bits 3-6 into bits 4-7 (thus discarding bit 7, which corresponds to the key to no. 19)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30380"></span>30380</td>
<td class="bytes-0"></td>
<td class="instruction">LD BC,1072</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=4 (there are 4 keys), <span class="register">C</span>=48 (INK 6: PAPER 0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30383"></span>30383</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,23280</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the attribute byte for the leftmost key in the icon panel</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30386"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29716.html">29716</a> with <span class="register">HL</span>=23272 (attribute byte for the leftmost first aid kit in the icon panel) and <span class="register">C</span>=50 (INK 2: PAPER 6).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30386"></span>30386</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),54</td>
<td class="comment-11" rowspan="1">Set the attribute byte to 54 (INK 6: PAPER 6) by default</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30388"></span>30388</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1">Should there be a first aid kit or key displayed here?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30389"></span>30389</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,30392</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30391"></span>30391</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),C</td>
<td class="comment-11" rowspan="1">Otherwise reveal the first aid kit or key by setting the attribute byte to 50 (INK 2: PAPER 6) or 48 (INK 6: PAPER 0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30392"></span>30392</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> to the attribute byte for the next first aid kit or key</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30393"></span>30393</td>
<td class="bytes-0"></td>
<td class="instruction">DJNZ 30386</td>
<td class="comment-11" rowspan="1">Jump back until all the first aid kits or keys have been done</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30395"></span>30395</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30198.html">30198</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30211">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30396.html">30396</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20190619</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/7603.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>