<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 60082</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60032.html">60032</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60082">Map</a></td>
<td class="next">
Next: <a href="60120.html">60120</a>
</td>
</tr>
</table>
<div class="description">60082: Get the keypress offset of the last key pressed (1)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="31126.html">31126</a>. Returns with the zero flag set if no game keys were pressed. Otherwise returns with <span class="register">A</span> holding the value from the <a href="49968.html">keypress offset table</a> corresponding to the last key pressed or joystick movement made. This offset (an odd number from 1 to 39) points at an entry in the table of keypress handling routines at <a href="60672.html">60672</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60082"></span>60082</td>
<td class="instruction">CALL <a href="60121.html">60121</a></td>
<td class="comment-1" rowspan="1">Collect the ASCII code of the last key pressed in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="60085"></span>60085</td>
<td class="instruction">JR NZ,<a href="60146.html">60146</a></td>
<td class="comment-1" rowspan="1">Jump if a key was pressed</td>
</tr>
<tr>
<td class="address-1"><span id="60087"></span>60087</td>
<td class="instruction">LD A,(32762)</td>
<td class="comment-1" rowspan="1">Collect the input device indicator from <a href="32762.html">32762</a></td>
</tr>
<tr>
<td class="address-1"><span id="60090"></span>60090</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Are we using the Kempston joystick?</td>
</tr>
<tr>
<td class="address-1"><span id="60091"></span>60091</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return with the zero flag set if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60092"></span>
<div class="comments">
<div class="paragraph">
We are using the Kempston joystick.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="60092"></span>60092</td>
<td class="instruction">IN A,(31)</td>
<td class="comment-1" rowspan="1">Take a reading from the joystick port</td>
</tr>
<tr>
<td class="address-1"><span id="60094"></span>60094</td>
<td class="instruction">AND 31</td>
<td class="comment-1" rowspan="1">Any input from the joystick?</td>
</tr>
<tr>
<td class="address-1"><span id="60096"></span>60096</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="address-1"><span id="60097"></span>60097</td>
<td class="instruction">LD L,80</td>
<td class="comment-1" rowspan="1">80='P' (RIGHT)</td>
</tr>
<tr>
<td class="address-1"><span id="60099"></span>60099</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Was the joystick moved right?</td>
</tr>
<tr>
<td class="address-1"><span id="60100"></span>60100</td>
<td class="instruction">JR C,<a href="60146.html#60147">60147</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60102"></span>60102</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=79='O' (LEFT)</td>
</tr>
<tr>
<td class="address-1"><span id="60103"></span>60103</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Was the joystick moved left?</td>
</tr>
<tr>
<td class="address-1"><span id="60104"></span>60104</td>
<td class="instruction">JR C,<a href="60146.html#60147">60147</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60106"></span>60106</td>
<td class="instruction">LD L,65</td>
<td class="comment-1" rowspan="1">65='A' (DOWN)</td>
</tr>
<tr>
<td class="address-1"><span id="60108"></span>60108</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Was the joystick moved down?</td>
</tr>
<tr>
<td class="address-1"><span id="60109"></span>60109</td>
<td class="instruction">JR C,<a href="60146.html#60147">60147</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60111"></span>60111</td>
<td class="instruction">LD L,81</td>
<td class="comment-1" rowspan="1">81='Q' (UP)</td>
</tr>
<tr>
<td class="address-1"><span id="60113"></span>60113</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Was the joystick moved up?</td>
</tr>
<tr>
<td class="address-1"><span id="60114"></span>60114</td>
<td class="instruction">JR C,<a href="60146.html#60147">60147</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60116"></span>60116</td>
<td class="instruction">LD L,107</td>
<td class="comment-1" rowspan="1">107='k' (knock on or open a door)</td>
</tr>
<tr>
<td class="address-1"><span id="60118"></span>60118</td>
<td class="instruction">JR <a href="60146.html#60147">60147</a></td>
<td class="comment-1" rowspan="1">Collect and return the keypress offset that corresponds to the joystick movement</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60032.html">60032</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60082">Map</a></td>
<td class="next">
Next: <a href="60120.html">60120</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20191116</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/EAB2.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>