<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 30675</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30627.html">30627</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30675">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30822.html">30822</a></span></td>
</tr>
</table>
<div class="description">30675: Deal with Sam when he's on the phone</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="29912.html">29912</a> when bit 4 at <a href="32764.html">32764</a> is set (by the routine at <a href="30458.html">30458</a>), indicating that Sam is on the phone.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30675"></span>30675</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32667</td>
<td class="comment-11" rowspan="1">The telephone call status flags are stored at <a href="32667.html">32667</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30678"></span>30678</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Has someone asked Sam 'WHO'S THERE?'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30680"></span>30680</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="30575.html">30575</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30683"></span>30683</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 1,(HL)</td>
<td class="comment-11" rowspan="1">Is the telephone call still in progress?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30685"></span>30685</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30691</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30687"></span>30687</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="61923.html">61923</a></td>
<td class="comment-11" rowspan="1">Hang up if 'h' was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30690"></span>30690</td>
<td class="bytes-0"></td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30691"></span>
<div class="comments">
<div class="paragraph">
The telephone call is still in progress.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30691"></span>30691</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Has Sam picked up a telephone that was ringing?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30693"></span>30693</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30707</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30695"></span>30695</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="61923.html">61923</a></td>
<td class="comment-11" rowspan="1">Hang up if 'h' was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30698"></span>30698</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32723)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ID of the telephone that Sam is holding</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30701"></span>30701</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,27467</td>
<td class="comment-11" rowspan="1">The ringing phone location table is at <a href="27467.html">27467</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30704"></span>30704</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="30627.html">30627</a></td>
<td class="comment-11" rowspan="1">Check whether there is a message for Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30707"></span>30707</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-11" rowspan="1">Is the destination telephone ringing?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30709"></span>30709</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30726</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30711"></span>30711</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="61923.html">61923</a></td>
<td class="comment-11" rowspan="1">Hang up if 'h' was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30714"></span>30714</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="30511.html">30511</a></td>
<td class="comment-11" rowspan="1">Is the telephone that Sam is calling either off-screen or close enough to a character that can pick it up?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30717"></span>30717</td>
<td class="bytes-0"></td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30718"></span>30718</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32666)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ID of the telephone that Sam is calling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30721"></span>30721</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,27506</td>
<td class="comment-11" rowspan="1">The phone message table is at <a href="27506.html">27506</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30724"></span>30724</td>
<td class="bytes-0"></td>
<td class="instruction">JR 30704</td>
<td class="comment-11" rowspan="1">Check whether Sam has called someone who has a message for him</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30726"></span>
<div class="comments">
<div class="paragraph">
Sam is still dialling the telephone number.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30726"></span>30726</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 4,(HL)</td>
<td class="comment-11" rowspan="1">Are we currently making the sound effect of a digit being dialled?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30728"></span>30728</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30768</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30730"></span>30730</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="61923.html">61923</a></td>
<td class="comment-11" rowspan="1">Check for keypresses and hang up if 'h' was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30733"></span>30733</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if no key with an ASCII code in the range 48-127 was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30734"></span>30734</td>
<td class="bytes-0"></td>
<td class="instruction">CP 58</td>
<td class="comment-11" rowspan="1">Was the ASCII code of the keypress greater than 57 ('9')?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30736"></span>30736</td>
<td class="bytes-0"></td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30737"></span>30737</td>
<td class="bytes-0"></td>
<td class="instruction">CP 48</td>
<td class="comment-11" rowspan="1">Was the ASCII code less than 48 ('0')?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30739"></span>30739</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30740"></span>30740</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32657</td>
<td class="comment-11" rowspan="5">Store the ASCII code of the digit in the first available space at <a href="32658.html">32658</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30743"></span>30743</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30744"></span>30744</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30746"></span>30746</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30743</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30748"></span>30748</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30749"></span>30749</td>
<td class="bytes-0"></td>
<td class="instruction">SUB 48</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=digit that was dialled (0-9)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30751"></span>30751</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30755</td>
<td class="comment-11" rowspan="1">Jump unless '0' was dialled</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30753"></span>30753</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,10</td>
<td class="comment-11" rowspan="1">The digit '0' will give 10 clicks</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30755"></span>30755</td>
<td class="bytes-0"></td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1-11</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30756"></span>30756</td>
<td class="bytes-0"></td>
<td class="instruction">LD (58900),A</td>
<td class="comment-11" rowspan="1">Store this in byte 20 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30759"></span>30759</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,155</td>
<td class="comment-11" rowspan="1"><span class="register">HL</span>=<a href="32667.html">32667</a> (telephone call status flags)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30761"></span>30761</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),16</td>
<td class="comment-11" rowspan="1">Set bit 4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30763"></span>30763</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,42</td>
<td class="comment-11" rowspan="1">Message <a href="27141.html">42</a>: 'I DIALLED {number}'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30765"></span>30765</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="30154.html">30154</a></td>
<td class="comment-11" rowspan="1">Queue this message urgently</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30768"></span>
<div class="comments">
<div class="paragraph">
The sound effect of a digit being dialled is currently in progress.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30768"></span>30768</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,58888</td>
<td class="comment-11" rowspan="2">Set Sam's main action timer (in byte 8 of his buffer) to 3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30771"></span>30771</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30773"></span>30773</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,20</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 20 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30775"></span>30775</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Are there any more clicks to make?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30776"></span>30776</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="60521.html">60521</a></td>
<td class="comment-11" rowspan="1">Make a click if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="30779"></span>
<div class="comments">
<div class="paragraph">
Sam has finished dialling a digit of the telephone number. Check whether the number dialled so far is valid.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30779"></span>30779</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32667</td>
<td class="comment-11" rowspan="2">Clear all the telephone call status flags at <a href="32667.html">32667</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30782"></span>30782</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30784"></span>30784</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,146</td>
<td class="comment-11" rowspan="2">Collect the ASCII code of the first digit that was dialled from <a href="32658.html">32658</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30786"></span>30786</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30787"></span>30787</td>
<td class="bytes-0"></td>
<td class="instruction">CP 48</td>
<td class="comment-11" rowspan="1">Was it '0'?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30789"></span>30789</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30817</td>
<td class="comment-11" rowspan="1">Jump if so (no telephone numbers start with 0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30791"></span>30791</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="4">Add the ASCII codes of the second and third digits to the first</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30792"></span>30792</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30793"></span>30793</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30794"></span>30794</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30795"></span>30795</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the fourth digit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30796"></span>30796</td>
<td class="bytes-0"></td>
<td class="instruction">CP 171</td>
<td class="comment-11" rowspan="1">Set the zero flag if '999' was dialled</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30798"></span>30798</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,112</td>
<td class="comment-11" rowspan="1">112 is the ID of the telephone in the police station</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30800"></span>30800</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,30810</td>
<td class="comment-11" rowspan="1">Jump if Sam has dialled the police</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30802"></span>30802</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 5,(HL)</td>
<td class="comment-11" rowspan="1">Has Sam dialled four digits yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30804"></span>30804</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30805"></span>30805</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="31255.html">31255</a></td>
<td class="comment-11" rowspan="1">Has Sam dialled a valid telephone number?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30808"></span>30808</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,30817</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30810"></span>30810</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32723</td>
<td class="comment-11" rowspan="1"><a href="32723.html">32723</a> holds the ID of the telephone Sam is holding</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30813"></span>30813</td>
<td class="bytes-0"></td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does it match the ID of the telephone Sam is calling?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30814"></span>30814</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="31244.html">31244</a></td>
<td class="comment-11" rowspan="1">Jump if not to place the call</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30817"></span>30817</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,47</td>
<td class="comment-11" rowspan="1">Message <a href="27214.html">47</a>: ' THE NUMBER WAS UNOBTAINABLE'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30819"></span>30819</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="30575.html#30617">30617</a></td>
<td class="comment-11" rowspan="1">Disconnect the call and queue this message urgently</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30627.html">30627</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30675">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30822.html">30822</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20190619</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/77D3.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>