<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 29912</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29896.html">29896</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29912">Map</a></td>
<td class="next">
Next: <a href="29952.html">29952</a>
</td>
</tr>
</table>
<div class="description">29912: Deal with Sam</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Called from the main loop at <a href="61483.html">61483</a> when one of Sam's status flags at <a href="32764.html">32764</a> is set, indicating that he is in the middle of an action. Returns with the zero flag set if Sam has finished the action by the end of the routine.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29912"></span>29912</td>
<td class="instruction">LD HL,58888</td>
<td class="comment-1" rowspan="2">Decrement Sam's main action timer in byte 8 of his buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29915"></span>29915</td>
<td class="instruction">DEC (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="29916"></span>29916</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return unless it's time to deal with Sam</td>
</tr>
<tr>
<td class="address-1"><span id="29917"></span>29917</td>
<td class="instruction">LD HL,29939</td>
<td class="comment-1" rowspan="2">We will continue at <a href="29912.html#29939">29939</a> (below) after calling the routine to handle Sam</td>
</tr>
<tr>
<td class="address-1"><span id="29920"></span>29920</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="address-1"><span id="29921"></span>29921</td>
<td class="instruction">LD L,198</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=29894</td>
</tr>
<tr>
<td class="address-1"><span id="29923"></span>29923</td>
<td class="instruction">LD A,(32764)</td>
<td class="comment-1" rowspan="1">Pick up Sam's status flags from <a href="32764.html">32764</a></td>
</tr>
<tr>
<td class="address-2"><span id="29926"></span>29926</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="4">Point <span class="register">HL</span> at one of the entries in the table of Sam-handling routine addresses at <a href="29896.html">29896</a></td>
</tr>
<tr>
<td class="address-1"><span id="29927"></span>29927</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="29928"></span>29928</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="29929"></span>29929</td>
<td class="instruction">JR NC,29926</td>
</tr>
<tr>
<td class="address-1"><span id="29931"></span>29931</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="3">Collect the routine address into <span class="register">BC</span></td>
</tr>
<tr>
<td class="address-1"><span id="29932"></span>29932</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="29933"></span>29933</td>
<td class="instruction">LD B,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="29934"></span>29934</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Push it onto the stack, ready for an indirect jump</td>
</tr>
<tr>
<td class="address-1"><span id="29935"></span>29935</td>
<td class="instruction">LD HL,58880</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0 of Sam's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29938"></span>29938</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Make an indirect jump to the Sam-handling routine</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29939"></span>
<div class="comments">
<div class="paragraph">
We come here after the Sam-handling routine has returned.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29939"></span>29939</td>
<td class="instruction">LD HL,32764</td>
<td class="comment-1" rowspan="1"><a href="32764.html">32764</a> holds Sam's status flags</td>
</tr>
<tr>
<td class="address-1"><span id="29942"></span>29942</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick them up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="29943"></span>29943</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Has Sam finished the action yet?</td>
</tr>
<tr>
<td class="address-1"><span id="29944"></span>29944</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return with the zero flag set if so</td>
</tr>
<tr>
<td class="address-1"><span id="29945"></span>29945</td>
<td class="instruction">LD A,(58888)</td>
<td class="comment-1" rowspan="1">Collect Sam's main action timer from byte 8 of his buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29948"></span>29948</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Did the Sam-handling routine set the action timer to a non-zero value (meaning that the action is still in progress)?</td>
</tr>
<tr>
<td class="address-1"><span id="29949"></span>29949</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return with the zero flag reset if so</td>
</tr>
<tr>
<td class="address-1"><span id="29950"></span>29950</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Otherwise clear all of Sam's status flags at <a href="32764.html">32764</a></td>
</tr>
<tr>
<td class="address-1"><span id="29951"></span>29951</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return with the zero flag set</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29896.html">29896</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29912">Map</a></td>
<td class="next">
Next: <a href="29952.html">29952</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20221122</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/74D8.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>