<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 31713</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="31670.html">31670</a></span></td>
<td class="up">Up: <a href="../maps/all.html#31713">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="31807.html">31807</a></span></td>
</tr>
</table>
<div class="description">31713: 'C' pressed - use hook</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
The address of this routine is found in the table of keypress handling routines at <a href="60672.html">60672</a>. It is called from the main loop at <a href="61483.html">61483</a> when 'C' is pressed.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31713"></span>31713</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(32745)</td>
<td class="comment-11" rowspan="1">Collect the object inventory flags from <a href="32745.html">32745</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31716"></span>31716</td>
<td class="bytes-0"></td>
<td class="instruction">BIT 6,A</td>
<td class="comment-11" rowspan="1">Has Sam got the hook?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31718"></span>31718</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31719"></span>31719</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(58884)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's z-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31722"></span>31722</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,(58881)</td>
<td class="comment-11" rowspan="1">Collect Sam's x- and y-coordinates in <span class="register">L</span> and <span class="register">H</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31725"></span>31725</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">Is Sam's z-coordinate 1 (indoors)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31726"></span>31726</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,31755</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31728"></span>31728</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x (Sam's x-coordinate)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31729"></span>31729</td>
<td class="bytes-0"></td>
<td class="instruction">CP 222</td>
<td class="comment-11" rowspan="1">Is Sam in no. 17 or no. 15 (x&gt;=222)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31731"></span>31731</td>
<td class="bytes-0"></td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31732"></span>31732</td>
<td class="bytes-0"></td>
<td class="instruction">CP 207</td>
<td class="comment-11" rowspan="1">Is Sam in no. 19 (207&lt;=x&lt;222)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31734"></span>31734</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,31751</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31736"></span>31736</td>
<td class="bytes-0"></td>
<td class="instruction">CP 122</td>
<td class="comment-11" rowspan="1">Is Sam in the police station, no. 27, or the apartments next to no. 19 (122&lt;=x&lt;207)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31738"></span>31738</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,31747</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31740"></span>31740</td>
<td class="bytes-0"></td>
<td class="instruction">CP 103</td>
<td class="comment-11" rowspan="1">Is Sam in no. 31 (103&lt;=x&lt;122)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31742"></span>31742</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,31751</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31744"></span>31744</td>
<td class="bytes-0"></td>
<td class="instruction">CP 25</td>
<td class="comment-11" rowspan="1">Is Sam in no. 74 or the hotel (25&lt;=x&lt;103)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31746"></span>31746</td>
<td class="bytes-0"></td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31747"></span>31747</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,7</td>
<td class="comment-11" rowspan="1">7 is the y-coordinate of the roof of the police station, no. 27, and the apartment building next to no. 19</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31749"></span>31749</td>
<td class="bytes-0"></td>
<td class="instruction">JR 31753</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31751"></span>31751</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,13</td>
<td class="comment-11" rowspan="1">13 is the y-coordinate of the roofs of no. 19 and no. 31</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31753"></span>31753</td>
<td class="bytes-0"></td>
<td class="instruction">CP H</td>
<td class="comment-11" rowspan="1">Is Sam on the roof of a building?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31754"></span>31754</td>
<td class="bytes-0"></td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31755"></span>
<div class="comments">
<div class="paragraph">
Sam is in a location that is amenable to hook-throwing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31755"></span>31755</td>
<td class="bytes-0"></td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=1+Sam's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31756"></span>31756</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(58880)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31759"></span>31759</td>
<td class="bytes-0"></td>
<td class="instruction">AND 128</td>
<td class="comment-11" rowspan="1">Keep only the direction bit (bit 7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31761"></span>31761</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,31764</td>
<td class="comment-11" rowspan="1">Jump if Sam is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31763"></span>31763</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1+Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="31764"></span>31764</td>
<td class="bytes-0"></td>
<td class="instruction">ADD A,121</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a href="../graphics/as.html#121">121/249</a> (hook)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31766"></span>31766</td>
<td class="bytes-0"></td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=hook's initial coordinates</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31767"></span>31767</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,58643</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 19 of character buffer 229</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31770"></span>31770</td>
<td class="bytes-0"></td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="2">Is the current owner of character buffer 229 (the hook or a banknote) under the control of an uninterruptible subcommand routine?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31771"></span>31771</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31772"></span>31772</td>
<td class="bytes-0"></td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so (the hook must currently be in flight, which is unlikely)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="31773"></span>
<div class="comments">
<div class="paragraph">
The hook will be thrown. Prepare it for launch now.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31773"></span>31773</td>
<td class="bytes-0"></td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Initialise the distance remaining for the hook to fly (stored in byte 20 of the hook's buffer)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31774"></span>31774</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),20</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31776"></span>31776</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="4">Place the address of the uninterruptible subcommand routine at <a href="31670.html">31670</a> into bytes 18 and 19 of the hook's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31777"></span>31777</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),123</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31779"></span>31779</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31780"></span>31780</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),182</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31782"></span>31782</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,4</td>
<td class="comment-11" rowspan="2">Set the hook's z-coordinate to 4</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31784"></span>31784</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31785"></span>31785</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Set bit 7 of byte 3 of the hook's buffer, thus making the hook fly as fast as possible</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31786"></span>31786</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31788"></span>31788</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="4">Initialise the hook's x- and y-coordinates</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31789"></span>31789</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31790"></span>31790</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31791"></span>31791</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31792"></span>31792</td>
<td class="bytes-0"></td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Initialise the hook's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31793"></span>31793</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31794"></span>31794</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="59861.html">59861</a></td>
<td class="comment-11" rowspan="1">Update the hook's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31797"></span>31797</td>
<td class="bytes-0"></td>
<td class="instruction">LD HL,32745</td>
<td class="comment-11" rowspan="1">The object inventory flags are stored at <a href="32745.html">32745</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31800"></span>31800</td>
<td class="bytes-0"></td>
<td class="instruction">RES 6,(HL)</td>
<td class="comment-11" rowspan="1">Clear bit 6, thus removing the hook from Sam's possession</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31802"></span>31802</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,230</td>
<td class="comment-11" rowspan="1">230=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="31804"></span>31804</td>
<td class="bytes-0"></td>
<td class="instruction">JP <a href="62212.html">62212</a></td>
<td class="comment-11" rowspan="1">Raise Sam's arm and make a sound effect</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="31670.html">31670</a></span></td>
<td class="up">Up: <a href="../maps/all.html#31713">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="31807.html">31807</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20190619</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/7BE1.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>