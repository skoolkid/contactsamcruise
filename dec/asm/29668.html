<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 29668</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29647.html">29647</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29668">Map</a></td>
<td class="next">
Next: <a href="29716.html">29716</a>
</td>
</tr>
</table>
<div class="description">29668: Show or hide the fuse, door, light bulb or phone in the icon panel (1)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="30989.html">30989</a> and <a href="61568.html">61568</a>. Shows or hides the fuse, door, light bulb or phone in the icon panel depending on Sam's current location and activity.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29668"></span>29668</td>
<td class="instruction">LD HL,58880</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 0 of Sam's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29671"></span>29671</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is Sam midstride?</td>
</tr>
<tr>
<td class="address-1"><span id="29673"></span>29673</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="29674"></span>29674</td>
<td class="instruction">LD A,(32764)</td>
<td class="comment-1" rowspan="1">Collect Sam's status flags from <a href="32764.html">32764</a></td>
</tr>
<tr>
<td class="address-1"><span id="29677"></span>29677</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Is Sam engaged in an action at the moment?</td>
</tr>
<tr>
<td class="address-1"><span id="29678"></span>29678</td>
<td class="instruction">JR Z,29706</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29680"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="29733.html">29733</a>. Now that the relevant bits at <a href="32680.html">32680</a> have been set or reset, it's time to show or hide the fuse, door, light bulb or phone in the icon panel.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29680"></span>29680</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="1">There are four icons to show or hide</td>
</tr>
<tr>
<td class="address-1"><span id="29682"></span>29682</td>
<td class="instruction">LD A,(32680)</td>
<td class="comment-1" rowspan="1">Collect the icon panel status flags from <a href="32680.html">32680</a></td>
</tr>
<tr>
<td class="address-1"><span id="29685"></span>29685</td>
<td class="instruction">LD E,166</td>
<td class="comment-1" rowspan="1"><span class="register">E</span> will hold the LSB of the attribute file address for the icon; initialise it to 166</td>
</tr>
<tr>
<td class="address-2"><span id="29687"></span>29687</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="2">Set <span class="register">E</span> to the LSB of the attribute file address for the next icon in the panel</td>
</tr>
<tr>
<td class="address-1"><span id="29688"></span>29688</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="address-1"><span id="29689"></span>29689</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="1">Set the carry flag if this icon should be shown</td>
</tr>
<tr>
<td class="address-1"><span id="29690"></span>29690</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Save the icon status flags</td>
</tr>
<tr>
<td class="address-1"><span id="29691"></span>29691</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save the LSB of the attribute file address</td>
</tr>
<tr>
<td class="address-1"><span id="29692"></span>29692</td>
<td class="instruction">CALL C,<a href="28703.html">28703</a></td>
<td class="comment-1" rowspan="1">Reveal the icon if necessary</td>
</tr>
<tr>
<td class="address-1"><span id="29695"></span>29695</td>
<td class="instruction">CALL NC,<a href="28703.html#28707">28707</a></td>
<td class="comment-1" rowspan="1">Or hide it if necessary</td>
</tr>
<tr>
<td class="address-1"><span id="29698"></span>29698</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the LSB of the attribute file address to <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="29699"></span>29699</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the icon status flags to <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="29700"></span>29700</td>
<td class="instruction">DJNZ 29687</td>
<td class="comment-1" rowspan="1">Jump back until the fuse, door, light bulb and phone icons have been revealed or hidden</td>
</tr>
<tr>
<td class="address-1"><span id="29702"></span>29702</td>
<td class="instruction">LD (32680),A</td>
<td class="comment-1" rowspan="1">Clear all the icon panel status flags at <a href="32680.html">32680</a></td>
</tr>
<tr>
<td class="address-1"><span id="29705"></span>29705</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="29706"></span>
<div class="comments">
<div class="paragraph">
Sam is not engaged in any action at the moment (no status flags at <a href="32764.html">32764</a> are set).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="29706"></span>29706</td>
<td class="instruction">LD A,(32747)</td>
<td class="comment-1" rowspan="1">Collect the police flags from <a href="32747.html">32747</a></td>
</tr>
<tr>
<td class="address-1"><span id="29709"></span>29709</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="1">Is Sam in jail?</td>
</tr>
<tr>
<td class="address-1"><span id="29710"></span>29710</td>
<td class="instruction">JR C,<a href="29733.html#29757">29757</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="29712"></span>29712</td>
<td class="instruction">LD L,2</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at byte 2 of Sam's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="29714"></span>29714</td>
<td class="instruction">JR <a href="29733.html">29733</a></td>
<td class="comment-1" rowspan="1">Check whether Sam is standing next to a fuse, door, light switch or telephone, and return here to update the icon panel as appropriate</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="29647.html">29647</a>
</td>
<td class="up">Up: <a href="../maps/all.html#29668">Map</a></td>
<td class="next">
Next: <a href="29716.html">29716</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20200812</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/73E4.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>