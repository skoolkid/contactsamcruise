<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 60179</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60152.html">60152</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60179">Map</a></td>
<td class="next">
Next: <a href="60291.html">60291</a>
</td>
</tr>
</table>
<div class="description">60179: Obtain descriptors for a character's current location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="28942.html">28942</a>, <a href="60347.html">60347</a>, <a href="60812.html">60812</a>, <a href="62216.html">62216</a> and <a href="64005.html">64005</a>. Looks for a location descriptor that corresponds to the character's current location and returns with <span class="register">A</span> and <span class="register">C</span> (and possibly also <span class="register">B</span>) holding values derived from that descriptor.
</div>
<div class="paragraph">
A location descriptor is a single byte (Q) if the location is on the sidewalk or road, or a sequence of two bytes ((Q,Q'), where bit 7 of Q is reset), or a sequence of three bytes ((Q,Q',Q''), where bit 7 of Q is set). For the location it corresponds to, a descriptor indicates the directions in which a character may move, and the directions that would require a change of z-coordinate; it may also indicate whether there is a door that can close at the location, and whether any movement from the location requires special handling by a separate routine (e.g. on the edge of a roof, or just behind the jail cell door).
</div>
<div class="paragraph">
The single-byte location descriptors (Q) that correspond to locations on the sidewalk or road can be found in the table at <a href="50176.html">50176</a>. The blocks of two- and three-byte location descriptors for locations not on the sidewalk or road are organised by x-coordinate; the LSBs and MSBs of their addresses can be found in the tables at <a href="50432.html">50432</a> and <a href="50688.html">50688</a>.
</div>
<div class="paragraph">
The first byte, Q, of a multi-byte location descriptor indicates the y-coordinate (y) and z-coordinate(s) (z) of the location to which the descriptor corresponds. In a two-byte descriptor (bit 7 of Q reset), bits 1-5 of Q hold y-4, and z is 2 if bit 6 is set, or 1 otherwise. In a three-byte descriptor (bit 7 of Q set), bits 0-4 of Q hold y-4, and z is determined by bits 5 and 6: if bit 6 is set, z=1 or 2 (meaning that the location is next to the entrance to a building); otherwise, z=2 if bit 5 is set or 1 if it's reset.
</div>
<div class="paragraph">
This routine returns with <span class="register">A</span> holding the location type indicator (1-5), and <span class="register">C</span> and <span class="register">B</span> holding the values derived from the relevant location descriptor:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1"><span class="register">C</span></th>
<th colspan="1" rowspan="1"><span class="register">B</span></th>
<th colspan="1" rowspan="1">Meaning</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1">Q</td>
<td class="centre" colspan="1" rowspan="1">-</td>
<td class="" colspan="1" rowspan="1">The sidewalk or the road</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1">Q'</td>
<td class="centre" colspan="1" rowspan="1">Q''</td>
<td class="" colspan="1" rowspan="1">At the (open) entrance to a building</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1">Q'</td>
<td class="centre" colspan="1" rowspan="1">Q''</td>
<td class="" colspan="1" rowspan="1">Behind or in front of a closed door</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="centre" colspan="1" rowspan="1">Q'</td>
<td class="centre" colspan="1" rowspan="1">Q''</td>
<td class="" colspan="1" rowspan="1">Location requires special handling</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1">Q'</td>
<td class="centre" colspan="1" rowspan="1">-</td>
<td class="" colspan="1" rowspan="1">Regular location (none of the above)</td>
</tr>
</table>
</div>
<div class="paragraph">
The value in <span class="register">C</span> (Q or Q') is the direction descriptor, which indicates the directions that are available, and (when <span class="register">A</span>=1 or 5) the directions that require special handling:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Bit</th>
<th colspan="1" rowspan="1">Meaning if set</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">Access to the left is granted</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Access to the right is granted</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">There is a step going up to the left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">There is a step going up to the right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">There is a step going down to the left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">There is a step going down to the right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="" colspan="1" rowspan="1">Character's z-coordinate will be 2 after going up to the left (when <span class="register">A</span>=1), or moving left requires special handling (when <span class="register">A</span>=5; see <a href="60347.html#60485">60485</a>)</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="" colspan="1" rowspan="1">Character's z-coordinate will be 2 after going up to the right (when <span class="register">A</span>=1), or moving right requires special handling (when <span class="register">A</span>=5; see <a href="60347.html#60485">60485</a>)</td>
</tr>
</table>
</div>
<div class="paragraph">
When <span class="register">A</span>=3, <span class="register">B</span> returns holding Q'', the third byte of the location descriptor. Bit 0 of this byte is set if there is a door that can close at the given location; bits 2-7 indicate whether the adjacent location in the corresponding direction is inside (set) or outside (reset) the building, and therefore may require a transition of the character's z-coordinate between 1 and 2 (see <a href="30396.html">30396</a>):
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Bit</th>
<th colspan="1" rowspan="1">Direction</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="" colspan="1" rowspan="1">Left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="" colspan="1" rowspan="1">Right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="" colspan="1" rowspan="1">Up/left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="" colspan="1" rowspan="1">Up/right</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="" colspan="1" rowspan="1">Down/left</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="" colspan="1" rowspan="1">Down/right</td>
</tr>
</table>
</div>
<div class="paragraph">
When <span class="register">A</span>=5, <span class="register">B</span> returns holding Q'', the third byte of the location descriptor; this byte determines the address of the routine to handle movement to the left or right at a special location (see <a href="60347.html#60485">60485</a>).
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="60179"></span>60179</td>
<td class="instruction">CALL <a href="60152.html">60152</a></td>
<td class="comment-1" rowspan="1">Is the character on the sidewalk or the road?</td>
</tr>
<tr>
<td class="address-1"><span id="60182"></span>60182</td>
<td class="instruction">JR C,60192</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="60184"></span>60184</td>
<td class="instruction">LD (HL),L</td>
<td class="comment-1" rowspan="1">Set the character's z-coordinate to 4 (on the sidewalk or road)</td>
</tr>
<tr>
<td class="address-1"><span id="60185"></span>60185</td>
<td class="instruction">LD D,196</td>
<td class="comment-1" rowspan="2">Collect a location descriptor from the table at <a href="50176.html">50176</a></td>
</tr>
<tr>
<td class="address-1"><span id="60187"></span>60187</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address-1"><span id="60188"></span>60188</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy the location descriptor to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="60189"></span>60189</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=1 (character is on the sidewalk or the road)</td>
</tr>
<tr>
<td class="address-1"><span id="60191"></span>60191</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60192"></span>
<div class="comments">
<div class="paragraph">
The character is not on the sidewalk or the road.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60192"></span>60192</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's z-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="60193"></span>60193</td>
<td class="instruction">CP 4</td>
<td class="comment-1" rowspan="1">Is the character outside?</td>
</tr>
<tr>
<td class="address-1"><span id="60195"></span>60195</td>
<td class="instruction">JR NZ,60199</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="60197"></span>60197</td>
<td class="instruction">LD (HL),2</td>
<td class="comment-1" rowspan="1">Set the character's z-coordinate to 2</td>
</tr>
<tr>
<td class="address-2"><span id="60199"></span>60199</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=y, the character's y-coordinate (6-35)</td>
</tr>
<tr>
<td class="address-1"><span id="60200"></span>60200</td>
<td class="instruction">SUB 4</td>
<td class="comment-1" rowspan="4"><span class="register">B</span>=4*(y-4)</td>
</tr>
<tr>
<td class="address-1"><span id="60202"></span>60202</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="60203"></span>60203</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="60204"></span>60204</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="address-1"><span id="60205"></span>60205</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is the character indoors?</td>
</tr>
<tr>
<td class="address-1"><span id="60207"></span>60207</td>
<td class="instruction">JR NZ,60211</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60209"></span>60209</td>
<td class="instruction">SET 7,B</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=128+4*(y-4) if the character's z-coordinate is 2</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60211"></span>
<div class="comments">
<div class="paragraph">
Now <span class="register">B</span> holds a value indicating the character's y-coordinate (bits 2-6: y-4) and z-coordinate (bit 7: z-1).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60211"></span>60211</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="60212"></span>60212</td>
<td class="instruction">LD H,197</td>
<td class="comment-1" rowspan="2">Collect an LSB from the table at <a href="50432.html">50432</a></td>
</tr>
<tr>
<td class="address-1"><span id="60214"></span>60214</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="60215"></span>60215</td>
<td class="instruction">SUB 2</td>
<td class="comment-1" rowspan="1">Subtract 2 from this LSB</td>
</tr>
<tr>
<td class="address-1"><span id="60217"></span>60217</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at an MSB in the table at <a href="50688.html">50688</a></td>
</tr>
<tr>
<td class="address-1"><span id="60218"></span>60218</td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the MSB in <span class="register">H</span></td>
</tr>
<tr>
<td class="address-1"><span id="60219"></span>60219</td>
<td class="instruction">LD E,L</td>
<td class="comment-1" rowspan="1"><span class="register">E</span>=character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="60220"></span>60220</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Now <span class="register">HL</span> holds 2 less than the address formed by the LSB and MSB just collected from the tables at <a href="50432.html">50432</a> and <a href="50688.html">50688</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60221"></span>
<div class="comments">
<div class="paragraph">
The loop that iterates over the location descriptors for the character's x-coordinate begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60221"></span>60221</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Move <span class="register">HL</span> along the location descriptor table</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60222"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="60720.html">60720</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60222"></span>60222</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the first byte of a location descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="60223"></span>60223</td>
<td class="instruction">JR Z,60229</td>
<td class="comment-1" rowspan="1">Jump if we reached a page boundary</td>
</tr>
<tr>
<td class="address-1"><span id="60225"></span>60225</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the first byte (Q) of the location descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="60226"></span>60226</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Have we reached the end of the location descriptors for the character's x-coordinate?</td>
</tr>
<tr>
<td class="address-1"><span id="60227"></span>60227</td>
<td class="instruction">JR NZ,60234</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60229"></span>
<div class="comments">
<div class="paragraph">
The character is not at any of the locations to which the location descriptors for his x-coordinate correspond.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60229"></span>60229</td>
<td class="instruction">LD C,192</td>
<td class="comment-1" rowspan="1">Bits 7 and 6 set: the character can move left or right only</td>
</tr>
<tr>
<td class="address-1"><span id="60231"></span>60231</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2: regular location</td>
</tr>
<tr>
<td class="address-1"><span id="60233"></span>60233</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60234"></span>
<div class="comments">
<div class="paragraph">
Here we examine a location descriptor and check whether the character is at the location to which it corresponds.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60234"></span>60234</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Q (first byte of the location descriptor)</td>
</tr>
<tr>
<td class="address-1"><span id="60235"></span>60235</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the second byte of the location descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="60236"></span>60236</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="1">Is bit 7 of Q set (meaning this location is next to the entrance to a building or requires special handling)?</td>
</tr>
<tr>
<td class="address-1"><span id="60237"></span>60237</td>
<td class="instruction">JR C,60246</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60239"></span>60239</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1">Is the character at the location to which the location descriptor corresponds?</td>
</tr>
<tr>
<td class="address-1"><span id="60240"></span>60240</td>
<td class="instruction">JR NZ,60222</td>
<td class="comment-1" rowspan="1">Move along to the next location descriptor if not</td>
</tr>
<tr>
<td class="address-1"><span id="60242"></span>60242</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=Q' (second byte of the location descriptor)</td>
</tr>
<tr>
<td class="address-1"><span id="60243"></span>60243</td>
<td class="instruction">LD A,2</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=2: regular location</td>
</tr>
<tr>
<td class="address-1"><span id="60245"></span>60245</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60246"></span>
<div class="comments">
<div class="paragraph">
The location descriptor being examined has bit 7 of its first byte set, which means that it corresponds to a location that is next to the entrance to a building, or a location that requires special handling.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60246"></span>60246</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="1">Is bit 6 of Q set (meaning this location is next to the entrance to a building)?</td>
</tr>
<tr>
<td class="address-1"><span id="60247"></span>60247</td>
<td class="instruction">JR C,60258</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="60249"></span>60249</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="1">Is the character at the location to which the location descriptor corresponds?</td>
</tr>
<tr>
<td class="address-1"><span id="60250"></span>60250</td>
<td class="instruction">JR NZ,60221</td>
<td class="comment-1" rowspan="1">Move along to the next location descriptor if not</td>
</tr>
<tr>
<td class="address-1"><span id="60252"></span>60252</td>
<td class="instruction">LD A,5</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=5: this location requires special handling</td>
</tr>
<tr>
<td class="address-2"><span id="60254"></span>60254</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="3">Collect the second and third bytes of the location descriptor (Q' and Q'') in <span class="register">C</span> and <span class="register">B</span></td>
</tr>
<tr>
<td class="address-1"><span id="60255"></span>60255</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="address-1"><span id="60256"></span>60256</td>
<td class="instruction">LD B,(HL)</td>
</tr>
<tr>
<td class="address-1"><span id="60257"></span>60257</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60258"></span>
<div class="comments">
<div class="paragraph">
The location descriptor being examined has bits 7 and 6 of its first byte set, which means that it corresponds to a location that is next to the entrance to a building (where a character's z-coordinate may be 1 or 2).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="60258"></span>60258</td>
<td class="instruction">LD C,B</td>
<td class="comment-1" rowspan="2"><span class="register">C</span>=4*(y-4) (where y is the character's y-coordinate)</td>
</tr>
<tr>
<td class="address-1"><span id="60259"></span>60259</td>
<td class="instruction">RES 7,C</td>
</tr>
<tr>
<td class="address-1"><span id="60261"></span>60261</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="1">Is the character at the location to which the location descriptor corresponds?</td>
</tr>
<tr>
<td class="address-1"><span id="60262"></span>60262</td>
<td class="instruction">JR NZ,60221</td>
<td class="comment-1" rowspan="1">Move along to the next location descriptor if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="60264"></span>
<div class="comments">
<div class="paragraph">
The character is standing next to the entrance to a building. Check whether a closed door is in his way.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="60264"></span>60264</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the third byte of the location descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="60265"></span>60265</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Is there a door at this location?</td>
</tr>
<tr>
<td class="address-1"><span id="60267"></span>60267</td>
<td class="instruction">JR Z,60286</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="60269"></span>60269</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=x, the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="60270"></span>60270</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="5"><span class="register">A</span>=INT((x+1)/8)</td>
</tr>
<tr>
<td class="address-1"><span id="60271"></span>60271</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="60272"></span>60272</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="60273"></span>60273</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="60274"></span>60274</td>
<td class="instruction">AND 31</td>
</tr>
<tr>
<td class="address-1"><span id="60276"></span>60276</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Save the location descriptor pointer briefly</td>
</tr>
<tr>
<td class="address-1"><span id="60277"></span>60277</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the entry in the table of Z values at <a href="48384.html">48384</a> that corresponds to the door</td>
</tr>
<tr>
<td class="address-1"><span id="60278"></span>60278</td>
<td class="instruction">LD H,189</td>
</tr>
<tr>
<td class="address-1"><span id="60280"></span>60280</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-1" rowspan="1">Set the zero flag if the door is open</td>
</tr>
<tr>
<td class="address-1"><span id="60282"></span>60282</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the location descriptor pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="address-1"><span id="60283"></span>60283</td>
<td class="instruction">JP NZ,<a href="60720.html">60720</a></td>
<td class="comment-1" rowspan="1">Jump if the door is closed to find the location descriptor that corresponds to the character's z-coordinate (1=behind the door, 2=in front of it)</td>
</tr>
<tr>
<td class="address-2"><span id="60286"></span>60286</td>
<td class="instruction">LD A,3</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=3: the character is standing next to the open entrance to a building</td>
</tr>
<tr>
<td class="address-1"><span id="60288"></span>60288</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the second byte of the location descriptor</td>
</tr>
<tr>
<td class="address-1"><span id="60289"></span>60289</td>
<td class="instruction">JR 60254</td>
<td class="comment-1" rowspan="1">Jump back to collect the second and third bytes (Q' and Q'') in <span class="register">C</span> and <span class="register">B</span></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="60152.html">60152</a>
</td>
<td class="up">Up: <a href="../maps/all.html#60179">Map</a></td>
<td class="next">
Next: <a href="60291.html">60291</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20200812</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/EB13.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>