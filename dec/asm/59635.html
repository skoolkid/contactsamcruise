<!DOCTYPE html>
<html>
<head>
<title>Contact Sam Cruise: Routine at 59635</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Contact Sam Cruise" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="59632.html">59632</a>
</td>
<td class="up">Up: <a href="../maps/all.html#59635">Map</a></td>
<td class="next">
Next: <a href="59839.html">59839</a>
</td>
</tr>
</table>
<div class="description">59635: Superimpose sprite tiles onto a tile of the play area</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="59148.html">59148</a>. If any part of a character's sprite needs to be printed at the row and column specified by <span class="register">DE'</span>, the appropriate tile is located and superimposed onto the contents of the buffer at <a href="40990.html">40990</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">2</td>
</tr>
<tr>
<td class="register">D'</td>
<td class="register-desc">Play area y-coordinate</td>
</tr>
<tr>
<td class="register">E'</td>
<td class="register-desc">Play area x-coordinate</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="59635"></span>59635</td>
<td class="instruction">CALL 59640</td>
<td class="comment-1" rowspan="1">Superimpose sprite tiles for characters whose z-coordinate is 2 (between a building and the sidewalk)</td>
</tr>
<tr>
<td class="address-1"><span id="59638"></span>59638</td>
<td class="instruction">LD A,4</td>
<td class="comment-1" rowspan="1">Prepare to superimpose sprite tiles for characters whose z-coordinate is 4 (on the sidewalk or road)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59640"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="59148.html">59148</a> with <span class="register">A</span>=1 (to superimpose sprite tiles for characters who are indoors).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59640"></span>59640</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59641"></span>59641</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1"><span class="register">C'</span>=1 (indoors), 2 (between buildings and the sidewalk) or 4 (on the sidewalk or road)</td>
</tr>
<tr>
<td class="address-1"><span id="59642"></span>59642</td>
<td class="instruction">LD H,215</td>
<td class="comment-1" rowspan="1">215 is the first character</td>
</tr>
<tr>
<td class="address-2"><span id="59644"></span>59644</td>
<td class="instruction">LD L,4</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 4 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59646"></span>59646</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's z-coordinate (1, 2, 4 or 8)</td>
</tr>
<tr>
<td class="address-1"><span id="59647"></span>59647</td>
<td class="instruction">AND C</td>
<td class="comment-1" rowspan="1">Reset the zero flag if the character's sprite should be printed</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59648"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="26002.html">26002</a> with <span class="register">H</span>=230 (Sam), <span class="register">DE</span> holding the play area coordinates of a bullet, and the zero flag reset unless Sam's indoors.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59648"></span>59648</td>
<td class="instruction">JR Z,59742</td>
<td class="comment-1" rowspan="1">Consider the next character if this one should not be printed</td>
</tr>
<tr>
<td class="address-1"><span id="59650"></span>59650</td>
<td class="instruction">LD L,0</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59652"></span>59652</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="59653"></span>59653</td>
<td class="instruction">AND 127</td>
<td class="comment-1" rowspan="1">Drop the direction bit (bit 7)</td>
</tr>
<tr>
<td class="address-1"><span id="59655"></span>59655</td>
<td class="instruction">CP 120</td>
<td class="comment-1" rowspan="1">Is this character's animatory state &gt;= 120?</td>
</tr>
<tr>
<td class="address-1"><span id="59657"></span>59657</td>
<td class="instruction">JR NC,59717</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59659"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is &lt; 120, which means he has a 5x3 sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="59659"></span>59659</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=1</td>
</tr>
<tr>
<td class="address-1"><span id="59660"></span>59660</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state + 1</td>
</tr>
<tr>
<td class="address-1"><span id="59661"></span>59661</td>
<td class="instruction">AND 7</td>
<td class="comment-1" rowspan="1">Reduce this modulo 8</td>
</tr>
<tr>
<td class="address-1"><span id="59663"></span>59663</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=X, the play area x-coordinate (0-255)</td>
</tr>
<tr>
<td class="address-1"><span id="59664"></span>59664</td>
<td class="instruction">JR Z,59692</td>
<td class="comment-1" rowspan="1">Jump if the character's animatory state is congruent to 7 mod 8</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59666"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is congruent to 0-6 mod 8, which means he has a sprite with 5 rows and 3 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="59666"></span>59666</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59667"></span>59667</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1">Does any part of the sprite impinge on column X?</td>
</tr>
<tr>
<td class="address-1"><span id="59669"></span>59669</td>
<td class="instruction">JR NC,59742</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="59671"></span>59671</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="59672"></span>59672</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="59674"></span>59674</td>
<td class="instruction">JR Z,59679</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="59676"></span>59676</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="2">Set <span class="register">A</span> to 2-<span class="register">A</span> if the character is facing right</td>
</tr>
<tr>
<td class="address-1"><span id="59677"></span>59677</td>
<td class="instruction">ADD A,3</td>
</tr>
<tr>
<td class="address-2"><span id="59679"></span>59679</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B'</span>=0, 1 or 2 (the column of the character's sprite at (X,Y))</td>
</tr>
<tr>
<td class="address-1"><span id="59680"></span>59680</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="3"><span class="register">A</span>=5*<span class="register">B</span></td>
</tr>
<tr>
<td class="address-1"><span id="59681"></span>59681</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="address-1"><span id="59682"></span>59682</td>
<td class="instruction">ADD A,B</td>
</tr>
<tr>
<td class="address-1"><span id="59683"></span>59683</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B'</span>=0, 5 or 10</td>
</tr>
<tr>
<td class="address-1"><span id="59684"></span>59684</td>
<td class="instruction">LD L,2</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 2 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59686"></span>59686</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="address-1"><span id="59687"></span>59687</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59688"></span>59688</td>
<td class="instruction">CP 5</td>
<td class="comment-1" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="address-1"><span id="59690"></span>59690</td>
<td class="instruction">JR 59740</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59692"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is congruent to 7 mod 8, which means he has a sprite with 3 rows and 5 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59692"></span>59692</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59693"></span>59693</td>
<td class="instruction">CP 5</td>
<td class="comment-1" rowspan="1">Does any part of the character impinge on column X?</td>
</tr>
<tr>
<td class="address-1"><span id="59695"></span>59695</td>
<td class="instruction">JR NC,59742</td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="59697"></span>59697</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="59698"></span>59698</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="59700"></span>59700</td>
<td class="instruction">JR Z,59705</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="59702"></span>59702</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="2">Set <span class="register">A</span>=4-<span class="register">A</span> if the character is facing right</td>
</tr>
<tr>
<td class="address-1"><span id="59703"></span>59703</td>
<td class="instruction">ADD A,5</td>
</tr>
<tr>
<td class="address-2"><span id="59705"></span>59705</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B'</span>=0, 1, 2, 3 or 4 (the column of the sprite at (X,Y))</td>
</tr>
<tr>
<td class="address-1"><span id="59706"></span>59706</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=3*<span class="register">B'</span></td>
</tr>
<tr>
<td class="address-1"><span id="59707"></span>59707</td>
<td class="instruction">ADD A,B</td>
</tr>
<tr>
<td class="address-1"><span id="59708"></span>59708</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B'</span>=0, 3, 6, 9 or 12</td>
</tr>
<tr>
<td class="address-1"><span id="59709"></span>59709</td>
<td class="instruction">LD L,2</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 2 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59711"></span>59711</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="address-1"><span id="59712"></span>59712</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59713"></span>59713</td>
<td class="instruction">CP 3</td>
<td class="comment-1" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="address-1"><span id="59715"></span>59715</td>
<td class="instruction">JR 59740</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59717"></span>
<div class="comments">
<div class="paragraph">
The character's animatory state is &gt;= 120, which means he has a sprite with 2 rows and 2 columns. Check whether any part of the sprite impinges on the tile at (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59717"></span>59717</td>
<td class="instruction">LD L,1</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59719"></span>59719</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=X, the play area x-coordinate (0-255)</td>
</tr>
<tr>
<td class="address-1"><span id="59720"></span>59720</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's x-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59721"></span>59721</td>
<td class="instruction">CP 2</td>
<td class="comment-1" rowspan="1">Does any part of the sprite impinge on column X?</td>
</tr>
<tr>
<td class="address-1"><span id="59723"></span>59723</td>
<td class="instruction">JR NC,59742</td>
<td class="comment-1" rowspan="1">Consider the next character if not</td>
</tr>
<tr>
<td class="address-1"><span id="59725"></span>59725</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1"><span class="register">L'</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="59726"></span>59726</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="address-1"><span id="59728"></span>59728</td>
<td class="instruction">JR Z,59732</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="59730"></span>59730</td>
<td class="instruction">XOR 1</td>
<td class="comment-1" rowspan="1">Set <span class="register">A</span>=1-<span class="register">A</span></td>
</tr>
<tr>
<td class="address-2"><span id="59732"></span>59732</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0 or 2</td>
</tr>
<tr>
<td class="address-1"><span id="59733"></span>59733</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B'</span>=0 or 2</td>
</tr>
<tr>
<td class="address-1"><span id="59734"></span>59734</td>
<td class="instruction">LD L,2</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 2 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59736"></span>59736</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=Y, the play area y-coordinate (2-39)</td>
</tr>
<tr>
<td class="address-1"><span id="59737"></span>59737</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-1" rowspan="1">Subtract the character's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="59738"></span>59738</td>
<td class="instruction">CP 2</td>
<td class="comment-1" rowspan="1">Set the carry flag if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="address-2"><span id="59740"></span>59740</td>
<td class="instruction">JR C,59750</td>
<td class="comment-1" rowspan="1">Jump if the sprite impinges on row Y</td>
</tr>
<tr>
<td class="address-2"><span id="59742"></span>59742</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Next character</td>
</tr>
<tr>
<td class="address-1"><span id="59743"></span>59743</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="address-1"><span id="59744"></span>59744</td>
<td class="instruction">CP 231</td>
<td class="comment-1" rowspan="1">Have we done all the characters (215-230)?</td>
</tr>
<tr>
<td class="address-1"><span id="59746"></span>59746</td>
<td class="instruction">JR NZ,59644</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="address-1"><span id="59748"></span>59748</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59749"></span>59749</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59750"></span>
<div class="comments">
<div class="paragraph">
The character's sprite impinges on the tile at coordinates (X,Y).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59750"></span>59750</td>
<td class="instruction">ADD A,B</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0-14 (index of the sprite tile at (X,Y))</td>
</tr>
<tr>
<td class="address-1"><span id="59751"></span>59751</td>
<td class="instruction">ADD A,215</td>
<td class="comment-1" rowspan="1">215&lt;=<span class="register">A</span>&lt;=229</td>
</tr>
<tr>
<td class="address-1"><span id="59753"></span>59753</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59754"></span>59754</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1">215&lt;=<span class="register">H</span>&lt;=229</td>
</tr>
<tr>
<td class="address-1"><span id="59755"></span>59755</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59756"></span>59756</td>
<td class="instruction">LD L,0</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL'</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59758"></span>59758</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="59759"></span>59759</td>
<td class="instruction">AND 7</td>
<td class="comment-1" rowspan="1">Keep only bits 0-2</td>
</tr>
<tr>
<td class="address-1"><span id="59761"></span>59761</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="59762"></span>59762</td>
<td class="instruction">JR NZ,59766</td>
<td class="comment-1" rowspan="1">Jump if the animatory state is congruent to 1-7 mod 8</td>
</tr>
<tr>
<td class="address-1"><span id="59764"></span>59764</td>
<td class="instruction">ADD A,2</td>
<td class="comment-1" rowspan="1">Add 2 if the animatory state is congruent to 0 mod 8</td>
</tr>
<tr>
<td class="address-2"><span id="59766"></span>59766</td>
<td class="instruction">OR 128</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>&gt;=129</td>
</tr>
<tr>
<td class="address-1"><span id="59768"></span>59768</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59769"></span>59769</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>&gt;=129, 215&lt;=<span class="register">H</span>&lt;=229</td>
</tr>
<tr>
<td class="address-1"><span id="59770"></span>59770</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=sprite tile reference (0-214, 217-255)</td>
</tr>
<tr>
<td class="address-1"><span id="59771"></span>59771</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Copy this to <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="59772"></span>59772</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set the zero flag if this is the blank tile</td>
</tr>
<tr>
<td class="address-1"><span id="59773"></span>59773</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59774"></span>59774</td>
<td class="instruction">JR Z,59742</td>
<td class="comment-1" rowspan="1">Jump back to consider the next character if the sprite tile is blank</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59776"></span>
<div class="comments">
<div class="paragraph">
A tile of this character's sprite needs to be printed at (X,Y). The apparent intention of the next section of code is to treat animatory states <a href="../graphics/as.html#120">120-127/248-255</a> (used only by the hook) specially, but the next instruction copies <span class="register">L'</span> (which holds 0) instead of <span class="register">L</span> (which holds the adjusted animatory state) into <span class="register">A</span>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="59776"></span>59776</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="address-1"><span id="59777"></span>59777</td>
<td class="instruction">CP 248</td>
<td class="comment-1" rowspan="1">This instruction sets the carry flag</td>
</tr>
<tr>
<td class="address-1"><span id="59779"></span>59779</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59780"></span>59780</td>
<td class="instruction">JR C,59791</td>
<td class="comment-1" rowspan="1">This jump is always made</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59782"></span>
<div class="comments">
<div class="paragraph">
The next section of code is never executed.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="59782"></span>59782</td>
<td class="instruction">LD H,219</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at one of the eight bytes at <a href="56312.html">56312</a> (which are all zero)</td>
</tr>
<tr>
<td class="address-1"><span id="59784"></span>59784</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Pick up the byte</td>
</tr>
<tr>
<td class="address-1"><span id="59785"></span>59785</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set the zero flag</td>
</tr>
<tr>
<td class="address-1"><span id="59786"></span>59786</td>
<td class="instruction">JR Z,59791</td>
<td class="comment-1" rowspan="1">This jump would always be made</td>
</tr>
<tr>
<td class="address-1"><span id="59788"></span>59788</td>
<td class="instruction">LD (43038),A</td>
<td class="comment-1" rowspan="1">Update the attribute byte stored at <a href="43038.html">43038</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59791"></span>
<div class="comments">
<div class="paragraph">
Normal service resumes here.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59791"></span>59791</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59792"></span>59792</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="address-1"><span id="59793"></span>59793</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59794"></span>59794</td>
<td class="instruction">LD D,199</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the graphic data for the sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="59796"></span>59796</td>
<td class="instruction">LD HL,40990</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the back buffer at <a href="40990.html">40990</a></td>
</tr>
<tr>
<td class="address-1"><span id="59799"></span>59799</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="1">Is the character facing right?</td>
</tr>
<tr>
<td class="address-1"><span id="59800"></span>59800</td>
<td class="instruction">JR C,59817</td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59802"></span>
<div class="comments">
<div class="paragraph">
The character is facing left, so we can use the tile as-is (there is no need to flip it).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="59802"></span>59802</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Now <span class="register">DE</span> points at the back buffer, and <span class="register">HL</span> points at the graphic data for the sprite tile</td>
</tr>
<tr>
<td class="address-2"><span id="59803"></span>59803</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a graphic byte from the back buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59804"></span>59804</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">OR on the sprite tile graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="59805"></span>59805</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the sprite tile mask byte</td>
</tr>
<tr>
<td class="address-1"><span id="59806"></span>59806</td>
<td class="instruction">AND (HL)</td>
<td class="comment-1" rowspan="1">AND on the sprite tile mask byte</td>
</tr>
<tr>
<td class="address-1"><span id="59807"></span>59807</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-1" rowspan="1">Update the back buffer byte</td>
</tr>
<tr>
<td class="address-1"><span id="59808"></span>59808</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next graphic byte of the sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="59809"></span>59809</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next byte of the back buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59810"></span>59810</td>
<td class="instruction">BIT 3,D</td>
<td class="comment-1" rowspan="1">Have we finished all 8 bytes?</td>
</tr>
<tr>
<td class="address-1"><span id="59812"></span>59812</td>
<td class="instruction">JR Z,59803</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="address-1"><span id="59814"></span>59814</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">This instruction is redundant</td>
</tr>
<tr>
<td class="address-1"><span id="59815"></span>59815</td>
<td class="instruction">JR 59836</td>
<td class="comment-1" rowspan="1">Consider the next character</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="59817"></span>
<div class="comments">
<div class="paragraph">
The character is facing right, so we need to flip the tile.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="59817"></span>59817</td>
<td class="instruction">LD B,126</td>
<td class="comment-1" rowspan="1">The table of mirror bytes is in <a href="32256.html">page 126</a></td>
</tr>
<tr>
<td class="address-2"><span id="59819"></span>59819</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a sprite tile graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="59820"></span>59820</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy it to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="59821"></span>59821</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=mirror image of the sprite tile graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="59822"></span>59822</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">OR on the back buffer graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="59823"></span>59823</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store the result in the back buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59824"></span>59824</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the sprite tile mask byte</td>
</tr>
<tr>
<td class="address-1"><span id="59825"></span>59825</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="59826"></span>59826</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Copy it to <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="59827"></span>59827</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=mirror image of the sprite tile mask byte</td>
</tr>
<tr>
<td class="address-1"><span id="59828"></span>59828</td>
<td class="instruction">AND (HL)</td>
<td class="comment-1" rowspan="1">AND on the back buffer graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="59829"></span>59829</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Store the result in the back buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59830"></span>59830</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next graphic byte of the sprite tile</td>
</tr>
<tr>
<td class="address-1"><span id="59831"></span>59831</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next byte of the back buffer</td>
</tr>
<tr>
<td class="address-1"><span id="59832"></span>59832</td>
<td class="instruction">BIT 3,H</td>
<td class="comment-1" rowspan="1">Have we finished all 8 bytes?</td>
</tr>
<tr>
<td class="address-1"><span id="59834"></span>59834</td>
<td class="instruction">JR Z,59819</td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="address-2"><span id="59836"></span>59836</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-1"><span id="59837"></span>59837</td>
<td class="instruction">JR 59742</td>
<td class="comment-1" rowspan="1">Jump back to consider the next character</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="59632.html">59632</a>
</td>
<td class="up">Up: <a href="../maps/all.html#59635">Map</a></td>
<td class="next">
Next: <a href="59839.html">59839</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Contact Sam Cruise RAM disassembly 20221122</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/E8F3.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>